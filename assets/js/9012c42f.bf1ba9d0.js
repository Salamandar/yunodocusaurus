"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([[739],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>k});var l=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,l,a=function(e,t){if(null==e)return{};var n,l,a={},i=Object.keys(e);for(l=0;l<i.length;l++)n=i[l],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(l=0;l<i.length;l++)n=i[l],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=l.createContext({}),p=function(e){var t=l.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=p(e.components);return l.createElement(s.Provider,{value:t},e.children)},d="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return l.createElement(l.Fragment,{},t)}},m=l.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=p(n),m=a,k=d["".concat(s,".").concat(m)]||d[m]||h[m]||i;return n?l.createElement(k,r(r({ref:t},u),{},{components:n})):l.createElement(k,r({ref:t},u))}));function k(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[d]="string"==typeof e?e:a,r[1]=o;for(var p=2;p<i;p++)r[p]=n[p];return l.createElement.apply(null,r)}return l.createElement.apply(null,n)}m.displayName="MDXCreateElement"},2867:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var l=n(7462),a=(n(7294),n(3905));const i={title:"App helpers",template:"docs",taxonomy:{category:"docs"},routes:{default:"/packaging_apps_helpers"}},r=void 0,o={unversionedId:"contribute/packaging_apps/resources/packaging_apps_helpers",id:"contribute/packaging_apps/resources/packaging_apps_helpers",title:"App helpers",description:"Doc auto-generated by this script on 22/07/2023 (YunoHost version 11.2.3)",source:"@site/docs/06.contribute/10.packaging_apps/80.resources/11.packaging_apps_helpers.md",sourceDirName:"06.contribute/10.packaging_apps/80.resources",slug:"/contribute/packaging_apps/resources/packaging_apps_helpers",permalink:"/yunodocusaurus/docs/contribute/packaging_apps/resources/packaging_apps_helpers",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/06.contribute/10.packaging_apps/80.resources/11.packaging_apps_helpers.md",tags:[],version:"current",sidebarPosition:11,frontMatter:{title:"App helpers",template:"docs",taxonomy:{category:"docs"},routes:{default:"/packaging_apps_helpers"}},sidebar:"tutorialSidebar",previous:{title:"Create a development environment with VirtualBox",permalink:"/yunodocusaurus/docs/contribute/packaging_apps/resources/packaging_apps_virtualbox"},next:{title:"App resources",permalink:"/yunodocusaurus/docs/contribute/packaging_apps/resources/packaging_apps_resources"}},s={},p=[{value:"APPS",id:"apps",level:2},{value:"ynh_install_apps",id:"ynh_install_apps",level:3},{value:"ynh_remove_apps",id:"ynh_remove_apps",level:3},{value:"ynh_spawn_app_shell",id:"ynh_spawn_app_shell",level:3},{value:"APT",id:"apt",level:2},{value:"ynh_package_is_installed",id:"ynh_package_is_installed",level:3},{value:"ynh_package_version",id:"ynh_package_version",level:3},{value:"ynh_package_update",id:"ynh_package_update",level:3},{value:"ynh_package_install",id:"ynh_package_install",level:3},{value:"ynh_package_remove",id:"ynh_package_remove",level:3},{value:"ynh_package_autoremove",id:"ynh_package_autoremove",level:3},{value:"ynh_package_autopurge",id:"ynh_package_autopurge",level:3},{value:"ynh_install_app_dependencies",id:"ynh_install_app_dependencies",level:3},{value:"ynh_add_app_dependencies",id:"ynh_add_app_dependencies",level:3},{value:"ynh_remove_app_dependencies",id:"ynh_remove_app_dependencies",level:3},{value:"ynh_install_extra_app_dependencies",id:"ynh_install_extra_app_dependencies",level:3},{value:"BACKUP",id:"backup",level:2},{value:"ynh_backup",id:"ynh_backup",level:3},{value:"ynh_restore",id:"ynh_restore",level:3},{value:"ynh_restore_file",id:"ynh_restore_file",level:3},{value:"ynh_store_file_checksum",id:"ynh_store_file_checksum",level:3},{value:"ynh_backup_if_checksum_is_different",id:"ynh_backup_if_checksum_is_different",level:3},{value:"ynh_delete_file_checksum",id:"ynh_delete_file_checksum",level:3},{value:"ynh_backup_before_upgrade",id:"ynh_backup_before_upgrade",level:3},{value:"ynh_restore_upgradebackup",id:"ynh_restore_upgradebackup",level:3},{value:"CONFIG",id:"config",level:2},{value:"FAIL2BAN",id:"fail2ban",level:2},{value:"ynh_add_fail2ban_config",id:"ynh_add_fail2ban_config",level:3},{value:"ynh_remove_fail2ban_config",id:"ynh_remove_fail2ban_config",level:3},{value:"GETOPTS",id:"getopts",level:2},{value:"HARDWARE",id:"hardware",level:2},{value:"ynh_get_ram",id:"ynh_get_ram",level:3},{value:"ynh_require_ram",id:"ynh_require_ram",level:3},{value:"LOGGING",id:"logging",level:2},{value:"ynh_die",id:"ynh_die",level:3},{value:"ynh_print_info",id:"ynh_print_info",level:3},{value:"ynh_print_warn",id:"ynh_print_warn",level:3},{value:"ynh_print_err",id:"ynh_print_err",level:3},{value:"ynh_exec_err",id:"ynh_exec_err",level:3},{value:"ynh_exec_warn",id:"ynh_exec_warn",level:3},{value:"ynh_exec_warn_less",id:"ynh_exec_warn_less",level:3},{value:"ynh_exec_quiet",id:"ynh_exec_quiet",level:3},{value:"ynh_exec_fully_quiet",id:"ynh_exec_fully_quiet",level:3},{value:"ynh_script_progression",id:"ynh_script_progression",level:3},{value:"ynh_return",id:"ynh_return",level:3},{value:"LOGROTATE",id:"logrotate",level:2},{value:"ynh_use_logrotate",id:"ynh_use_logrotate",level:3},{value:"ynh_remove_logrotate",id:"ynh_remove_logrotate",level:3},{value:"MULTIMEDIA",id:"multimedia",level:2},{value:"ynh_multimedia_build_main_dir",id:"ynh_multimedia_build_main_dir",level:3},{value:"ynh_multimedia_addfolder",id:"ynh_multimedia_addfolder",level:3},{value:"ynh_multimedia_addaccess",id:"ynh_multimedia_addaccess",level:3},{value:"MYSQL",id:"mysql",level:2},{value:"ynh_mysql_connect_as",id:"ynh_mysql_connect_as",level:3},{value:"ynh_mysql_execute_as_root",id:"ynh_mysql_execute_as_root",level:3},{value:"ynh_mysql_execute_file_as_root",id:"ynh_mysql_execute_file_as_root",level:3},{value:"ynh_mysql_dump_db",id:"ynh_mysql_dump_db",level:3},{value:"ynh_mysql_user_exists",id:"ynh_mysql_user_exists",level:3},{value:"ynh_mysql_setup_db",id:"ynh_mysql_setup_db",level:3},{value:"ynh_mysql_remove_db",id:"ynh_mysql_remove_db",level:3},{value:"NETWORK",id:"network",level:2},{value:"ynh_find_port",id:"ynh_find_port",level:3},{value:"ynh_port_available",id:"ynh_port_available",level:3},{value:"ynh_validate_ip4",id:"ynh_validate_ip4",level:3},{value:"ynh_validate_ip6",id:"ynh_validate_ip6",level:3},{value:"NGINX",id:"nginx",level:2},{value:"ynh_add_nginx_config",id:"ynh_add_nginx_config",level:3},{value:"ynh_remove_nginx_config",id:"ynh_remove_nginx_config",level:3},{value:"ynh_change_url_nginx_config",id:"ynh_change_url_nginx_config",level:3},{value:"NODEJS",id:"nodejs",level:2},{value:"ynh_use_nodejs",id:"ynh_use_nodejs",level:3},{value:"ynh_install_nodejs",id:"ynh_install_nodejs",level:3},{value:"ynh_remove_nodejs",id:"ynh_remove_nodejs",level:3},{value:"PERMISSION",id:"permission",level:2},{value:"ynh_permission_create",id:"ynh_permission_create",level:3},{value:"ynh_permission_delete",id:"ynh_permission_delete",level:3},{value:"ynh_permission_exists",id:"ynh_permission_exists",level:3},{value:"ynh_permission_url",id:"ynh_permission_url",level:3},{value:"ynh_permission_update",id:"ynh_permission_update",level:3},{value:"ynh_permission_has_user",id:"ynh_permission_has_user",level:3},{value:"ynh_legacy_permissions_exists",id:"ynh_legacy_permissions_exists",level:3},{value:"ynh_legacy_permissions_delete_all",id:"ynh_legacy_permissions_delete_all",level:3},{value:"PHP",id:"php",level:2},{value:"ynh_add_fpm_config",id:"ynh_add_fpm_config",level:3},{value:"ynh_remove_fpm_config",id:"ynh_remove_fpm_config",level:3},{value:"ynh_composer_exec",id:"ynh_composer_exec",level:3},{value:"ynh_install_composer",id:"ynh_install_composer",level:3},{value:"POSTGRESQL",id:"postgresql",level:2},{value:"ynh_psql_connect_as",id:"ynh_psql_connect_as",level:3},{value:"ynh_psql_execute_as_root",id:"ynh_psql_execute_as_root",level:3},{value:"ynh_psql_execute_file_as_root",id:"ynh_psql_execute_file_as_root",level:3},{value:"ynh_psql_dump_db",id:"ynh_psql_dump_db",level:3},{value:"ynh_psql_user_exists",id:"ynh_psql_user_exists",level:3},{value:"ynh_psql_database_exists",id:"ynh_psql_database_exists",level:3},{value:"ynh_psql_setup_db",id:"ynh_psql_setup_db",level:3},{value:"ynh_psql_remove_db",id:"ynh_psql_remove_db",level:3},{value:"SETTING",id:"setting",level:2},{value:"ynh_app_setting_get",id:"ynh_app_setting_get",level:3},{value:"ynh_app_setting_set",id:"ynh_app_setting_set",level:3},{value:"ynh_app_setting_delete",id:"ynh_app_setting_delete",level:3},{value:"ynh_webpath_available",id:"ynh_webpath_available",level:3},{value:"ynh_webpath_register",id:"ynh_webpath_register",level:3},{value:"STRING",id:"string",level:2},{value:"ynh_string_random",id:"ynh_string_random",level:3},{value:"ynh_replace_string",id:"ynh_replace_string",level:3},{value:"ynh_replace_special_string",id:"ynh_replace_special_string",level:3},{value:"ynh_sanitize_dbid",id:"ynh_sanitize_dbid",level:3},{value:"SYSTEMD",id:"systemd",level:2},{value:"ynh_add_systemd_config",id:"ynh_add_systemd_config",level:3},{value:"ynh_remove_systemd_config",id:"ynh_remove_systemd_config",level:3},{value:"ynh_systemd_action",id:"ynh_systemd_action",level:3},{value:"USER",id:"user",level:2},{value:"ynh_user_exists",id:"ynh_user_exists",level:3},{value:"ynh_user_get_info",id:"ynh_user_get_info",level:3},{value:"ynh_user_list",id:"ynh_user_list",level:3},{value:"ynh_system_user_exists",id:"ynh_system_user_exists",level:3},{value:"ynh_system_group_exists",id:"ynh_system_group_exists",level:3},{value:"ynh_system_user_create",id:"ynh_system_user_create",level:3},{value:"ynh_system_user_delete",id:"ynh_system_user_delete",level:3},{value:"ynh_exec_as",id:"ynh_exec_as",level:3},{value:"UTILS",id:"utils",level:2},{value:"ynh_abort_if_errors",id:"ynh_abort_if_errors",level:3},{value:"ynh_setup_source",id:"ynh_setup_source",level:3},{value:"New &#39;sources&#39; resources",id:"new-sources-resources",level:3},{value:"Optional flags",id:"optional-flags",level:4},{value:"Legacy format &#39;.src&#39;",id:"legacy-format-src",level:3},{value:"ynh_local_curl",id:"ynh_local_curl",level:3},{value:"ynh_add_config",id:"ynh_add_config",level:3},{value:"ynh_read_var_in_file",id:"ynh_read_var_in_file",level:3},{value:"ynh_write_var_in_file",id:"ynh_write_var_in_file",level:3},{value:"ynh_get_debian_release",id:"ynh_get_debian_release",level:3},{value:"ynh_secure_remove",id:"ynh_secure_remove",level:3},{value:"ynh_read_manifest",id:"ynh_read_manifest",level:3},{value:"ynh_app_upstream_version",id:"ynh_app_upstream_version",level:3},{value:"ynh_app_package_version",id:"ynh_app_package_version",level:3},{value:"ynh_check_app_version_changed",id:"ynh_check_app_version_changed",level:3},{value:"ynh_compare_current_package_version",id:"ynh_compare_current_package_version",level:3}],u={toc:p},d="wrapper";function h(e){let{components:t,...n}=e;return(0,a.kt)(d,(0,l.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Doc auto-generated by ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/doc/generate_helper_doc.py"},"this script")," on 22/07/2023 (YunoHost version 11.2.3)"),(0,a.kt)("h2",{id:"apps"},"APPS"),(0,a.kt)("h3",{id:"ynh_install_apps"},"ynh_install_apps"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Install others YunoHost apps")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_install_apps --apps="appfoo?domain=domain.foo&path=/foo appbar?domain=domain.bar&path=/bar&admin=USER&language=fr&is_public=1&pass?word=pass&port=666"')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-a"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--apps="),": apps to install")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version ",(0,a.kt)("em",{parentName:"p"},"."),".* or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/apps#L9"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_remove_apps"},"ynh_remove_apps"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Remove other YunoHost apps")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_remove_apps")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nOther YunoHost apps will be removed only if no other apps need them."),(0,a.kt)("p",null,"Requires YunoHost version ",(0,a.kt)("em",{parentName:"p"},"."),".* or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/apps#L65"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_spawn_app_shell"},"ynh_spawn_app_shell"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Spawn a Bash shell with the app environment loaded")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_spawn_app_shell --app="app"\n    | arg: -a, --app=     - the app ID')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Examples"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},'  ynh_spawn_app_shell --app="APP" <<< \'echo "$USER"\'')),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},'  ynh_spawn_app_shell --app="APP" < /tmp/some_script.bash'))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 11.0.* or higher, and that the app relies on packaging v2 or higher.\nThe spawned shell will have environment variables loaded and environment files sourced\nfrom the app's service configuration file (defaults to $app.service, overridable by the packager with ",(0,a.kt)("inlineCode",{parentName:"p"},"service")," setting).\nIf the app relies on a specific PHP version, then ",(0,a.kt)("inlineCode",{parentName:"p"},"php")," will be aliased that version. The PHP command will also be appended with the ",(0,a.kt)("inlineCode",{parentName:"p"},"phpflags")," settings."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/apps#L128"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"apt"},"APT"),(0,a.kt)("h3",{id:"ynh_package_is_installed"},"ynh_package_is_installed"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Check either a package is installed or not")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_package_is_installed --package=name")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-p"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--package="),": the package name to check")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": 0 if the package is installed, 1 else."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_package_is_installed --package=yunohost && echo "installed"')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/apt#L53"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_package_version"},"ynh_package_version"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Get the version of an installed package")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_package_version --package=name")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-p"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--package="),": the package name to get version")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": the version or an empty string"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"version=$(ynh_package_version --package=yunohost)")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/apt#L75"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_package_update"},"ynh_package_update"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Update package index files")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_package_update")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/apt#L107"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_package_install"},"ynh_package_install"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Install package(s)")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_package_install name [name [...]]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"name"),": the package name to install")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/apt#L117"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_package_remove"},"ynh_package_remove"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Remove package(s)")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_package_remove name [name [...]]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"name"),": the package name to remove")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/apt#L128"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_package_autoremove"},"ynh_package_autoremove"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Remove package(s) and their uneeded dependencies")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_package_autoremove name [name [...]]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"name"),": the package name to remove")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/apt#L138"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_package_autopurge"},"ynh_package_autopurge"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Purge package(s) and their uneeded dependencies")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_package_autopurge name [name [...]]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"name"),": the package name to autoremove and purge")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.7.2 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/apt#L148"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_install_app_dependencies"},"ynh_install_app_dependencies"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Define and install dependencies with a equivs control file")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_install_app_dependencies dep [dep [...]]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"dep"),": the package name to install in dependence."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},'"dep1|dep2|\u2026"'),": You can specify alternatives. It will require to install (dep1 or dep2, etc).")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nThis helper can/should only be called once per app"),(0,a.kt)("p",null,'example : ynh_install_app_dependencies dep1 dep2 "dep3|dep4|dep5"'),(0,a.kt)("p",null,"Requires YunoHost version 2.6.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/apt#L225"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_add_app_dependencies"},"ynh_add_app_dependencies"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Add dependencies to install with ynh_install_app_dependencies")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_add_app_dependencies --package=phpversion [--replace]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-p"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--package="),": Packages to add as dependencies for the app.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.8.1 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/apt#L338"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_remove_app_dependencies"},"ynh_remove_app_dependencies"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Remove fake package and its dependencies")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_remove_app_dependencies")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nDependencies will removed only if no other package need them."),(0,a.kt)("p",null,"Requires YunoHost version 2.6.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/apt#L357"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_install_extra_app_dependencies"},"ynh_install_extra_app_dependencies"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Install packages from an extra repository properly.")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_install_extra_app_dependencies --repo="repo" --package="dep1 dep2" [--key=key_url] [--name=name]')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-r"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--repo="),": Complete url of the extra repository."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-p"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--package="),": The packages to install from this extra repository"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-k"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--key="),": url to get the public key."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-n"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--name="),": Name for the files for this repo, $app as default value.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.8.1 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/apt#L391"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"backup"},"BACKUP"),(0,a.kt)("h3",{id:"ynh_backup"},"ynh_backup"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Add a file or a directory to the list of paths to backup")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_backup --src_path=src_path [--dest_path=dest_path] [--is_big] [--not_mandatory]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-s"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--src_path="),": file or directory to bind or symlink or copy. it shouldn't be in the backup dir."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-d"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--dest_path="),": destination file or directory inside the backup dir"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-b"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--is_big"),": Indicate data are big (mail, video, image ...)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-m"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--not_mandatory"),": Indicate that if the file is missing, the backup can ignore it.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nThis helper can be used both in a system backup hook, and in an app backup script"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"ynh_backup")," writes ",(0,a.kt)("inlineCode",{parentName:"p"},"src_path")," and the relative ",(0,a.kt)("inlineCode",{parentName:"p"},"dest_path")," into a CSV file, and it\ncreates the parent destination directory"),(0,a.kt)("p",null,"If ",(0,a.kt)("inlineCode",{parentName:"p"},"dest_path")," is ended by a slash it complete this path with the basename of ",(0,a.kt)("inlineCode",{parentName:"p"},"src_path"),"."),(0,a.kt)("p",null,"Example in the context of a wordpress app :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'ynh_backup "/etc/nginx/conf.d/$domain.d/$app.conf"\n# => This line will be added into CSV file\n# "/etc/nginx/conf.d/$domain.d/$app.conf","apps/wordpress/etc/nginx/conf.d/$domain.d/$app.conf"\n\nynh_backup "/etc/nginx/conf.d/$domain.d/$app.conf" "conf/nginx.conf"\n# => "/etc/nginx/conf.d/$domain.d/$app.conf","apps/wordpress/conf/nginx.conf"\n\nynh_backup "/etc/nginx/conf.d/$domain.d/$app.conf" "conf/"\n# => "/etc/nginx/conf.d/$domain.d/$app.conf","apps/wordpress/conf/$app.conf"\n\nynh_backup "/etc/nginx/conf.d/$domain.d/$app.conf" "conf"\n# => "/etc/nginx/conf.d/$domain.d/$app.conf","apps/wordpress/conf"\n\n#Deprecated usages (maintained for retro-compatibility)\nynh_backup "/etc/nginx/conf.d/$domain.d/$app.conf" "${backup_dir}/conf/nginx.conf"\n# => "/etc/nginx/conf.d/$domain.d/$app.conf","apps/wordpress/conf/nginx.conf"\n\nynh_backup "/etc/nginx/conf.d/$domain.d/$app.conf" "/conf/"\n# => "/etc/nginx/conf.d/$domain.d/$app.conf","apps/wordpress/conf/$app.conf"\n\n')),(0,a.kt)("p",null,"How to use ",(0,a.kt)("inlineCode",{parentName:"p"},"--is_big"),":"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"--is_big")," is used to specify that this part of the backup can be quite huge.\nSo, you don't want that your package does backup that part during ynh_backup_before_upgrade.\nIn the same way, an user may doesn't want to backup this big part of the app for\neach of his backup. And so handle that part differently."),(0,a.kt)("p",null,"As this part of your backup may not be done, your restore script has to handle it.\nIn your restore script, use ",(0,a.kt)("inlineCode",{parentName:"p"},"--not_mandatory")," with ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_restore_file"),"\nAs well in your remove script, you should not remove those data ! Or an user may end up with\na failed upgrade restoring an app without data anymore !"),(0,a.kt)("p",null,"To have the benefit of ",(0,a.kt)("inlineCode",{parentName:"p"},"--is_big")," while doing a backup, you can whether set the environement\nvariable ",(0,a.kt)("inlineCode",{parentName:"p"},"BACKUP_CORE_ONLY")," to 1 (",(0,a.kt)("inlineCode",{parentName:"p"},"BACKUP_CORE_ONLY=1"),") before the backup command. It will affect\nonly that backup command.\nOr set the config ",(0,a.kt)("inlineCode",{parentName:"p"},"do_not_backup_data")," to 1 into the ",(0,a.kt)("inlineCode",{parentName:"p"},"settings.yml")," of the app. This will affect\nall backups for this app until the setting is removed."),(0,a.kt)("p",null,"Requires YunoHost version 2.4.0 or higher.\nRequires YunoHost version 3.5.0 or higher for the argument ",(0,a.kt)("inlineCode",{parentName:"p"},"--not_mandatory")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/backup#L64"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_restore"},"ynh_restore"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Restore all files that were previously backuped in a core backup script or app backup script")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_restore")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.6.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/backup#L179"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_restore_file"},"ynh_restore_file"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Restore a file or a directory")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_restore_file --origin_path=origin_path [--dest_path=dest_path] [--not_mandatory]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-o"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--origin_path="),": Path where was located the file or the directory before to be backuped or relative path to $YNH_CWD where it is located in the backup archive"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-d"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--dest_path="),": Path where restore the file or the dir. If unspecified, the destination will be ",(0,a.kt)("inlineCode",{parentName:"li"},"ORIGIN_PATH")," or if the ",(0,a.kt)("inlineCode",{parentName:"li"},"ORIGIN_PATH")," doesn't exist in the archive, the destination will be searched into ",(0,a.kt)("inlineCode",{parentName:"li"},"backup.csv")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-m"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--not_mandatory"),": Indicate that if the file is missing, the restore process can ignore it.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Examples"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},'    ynh_restore_file -o "/etc/nginx/conf.d/$domain.d/$app.conf"')),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"You can also use relative paths:")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},'    ynh_restore_file -o "conf/nginx.conf"'))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nUse the registered path in backup_list by ynh_backup to restore the file at the right place."),(0,a.kt)("p",null,"If ",(0,a.kt)("inlineCode",{parentName:"p"},"DEST_PATH")," already exists and is lighter than 500 Mo, a backup will be made in\n",(0,a.kt)("inlineCode",{parentName:"p"},"/var/cache/yunohost/appconfbackup/"),". Otherwise, the existing file is removed."),(0,a.kt)("p",null,"if ",(0,a.kt)("inlineCode",{parentName:"p"},"apps/$app/etc/nginx/conf.d/$domain.d/$app.conf")," exists, restore it into\n",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/nginx/conf.d/$domain.d/$app.conf"),"\nif no, search for a match in the csv (eg: conf/nginx.conf) and restore it into\n",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/nginx/conf.d/$domain.d/$app.conf")),(0,a.kt)("p",null,"Requires YunoHost version 2.6.4 or higher.\nRequires YunoHost version 3.5.0 or higher for the argument --not_mandatory"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/backup#L238"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_store_file_checksum"},"ynh_store_file_checksum"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Calculate and store a file checksum into the app settings")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_store_file_checksum --file=file")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-f"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--file="),": The file on which the checksum will performed, then stored.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\n$app should be defined when calling this helper"),(0,a.kt)("p",null,"Requires YunoHost version 2.6.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/backup#L306"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_backup_if_checksum_is_different"},"ynh_backup_if_checksum_is_different"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Verify the checksum and backup the file if it's different")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_backup_if_checksum_is_different --file=file")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-f"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--file="),": The file on which the checksum test will be perfomed.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": the name of a backup file, or nothing"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nThis helper is primarily meant to allow to easily backup personalised/manually\nmodified config files."),(0,a.kt)("p",null,"Requires YunoHost version 2.6.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/backup#L357"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_delete_file_checksum"},"ynh_delete_file_checksum"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Delete a file checksum from the app settings")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_delete_file_checksum --file=file")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-f"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--file="),": The file for which the checksum will be deleted")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\n$app should be defined when calling this helper"),(0,a.kt)("p",null,"Requires YunoHost version 3.3.1 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/backup#L397"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_backup_before_upgrade"},"ynh_backup_before_upgrade"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Make a backup in case of failed upgrade")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_backup_before_upgrade")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nUsage in a package script:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"  ynh_backup_before_upgrade\n  ynh_clean_setup () {\n      ynh_restore_upgradebackup\n  }\n  ynh_abort_if_errors\n")),(0,a.kt)("p",null,"Requires YunoHost version 2.7.2 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/backup#L432"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_restore_upgradebackup"},"ynh_restore_upgradebackup"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Restore a previous backup if the upgrade process failed")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_restore_upgradebackup")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nUsage in a package script:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"  ynh_backup_before_upgrade\n  ynh_clean_setup () {\n      ynh_restore_upgradebackup\n  }\n  ynh_abort_if_errors\n")),(0,a.kt)("p",null,"Requires YunoHost version 2.7.2 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/backup#L480"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"config"},"CONFIG"),(0,a.kt)("h2",{id:"fail2ban"},"FAIL2BAN"),(0,a.kt)("h3",{id:"ynh_add_fail2ban_config"},"ynh_add_fail2ban_config"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Create a dedicated fail2ban config (jail and filter conf files)")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"1: ynh_add_fail2ban_config --logpath=log_file --failregex=filter [--max_retry=max_retry] [--ports=ports]\n2: ynh_add_fail2ban_config --use_template")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-l"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--logpath="),": Log file to be checked by fail2ban"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-r"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--failregex="),": Failregex to be looked for by fail2ban"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-m"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--max_retry="),": Maximum number of retries allowed before banning IP address - default: 3"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-p"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--ports="),": Ports blocked for a banned IP address - default: http,https"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-t"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--use_template"),": Use this helper in template mode")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null)),(0,a.kt)("p",null,"This will use a template in ",(0,a.kt)("inlineCode",{parentName:"p"},"../conf/f2b_jail.conf")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"../conf/f2b_filter.conf"),"\nSee the documentation of ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_add_config")," for a description of the template\nformat and how placeholders are replaced with actual variables."),(0,a.kt)("p",null,"Generally your template will look like that by example (for synapse):"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"f2b_jail.conf:\n    [__APP__]\n    enabled = true\n    port = http,https\n    filter = __APP__\n    logpath = /var/log/__APP__/logfile.log\n    maxretry = 3\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"f2b_filter.conf:\n    [INCLUDES]\n    before = common.conf\n    [Definition]\n\n# Part of regex definition (just used to make more easy to make the global regex)\n    __synapse_start_line = .? \\- synapse\\..+ \\-\n\n# Regex definition.\n   failregex = ^%(__synapse_start_line)s INFO \\- POST\\-(\\d+)\\- <HOST> \\- \\d+ \\- Received request\\: POST /_matrix/client/r0/login\\??<SKIPLINES>%(__synapse_start_line)s INFO \\- POST\\-\\1\\- Got login request with identifier: \\{u'type': u'm.id.user', u'user'\\: u'(.+?)'\\}, medium\\: None, address: None, user\\: u'\\5'<SKIPLINES>%(__synapse_start_line)s WARNING \\- \\- (Attempted to login as @\\5\\:.+ but they do not exist|Failed password login for user @\\5\\:.+)$\n\nignoreregex =\n")),(0,a.kt)("hr",null),(0,a.kt)("p",null,'Note about the "failregex" option:'),(0,a.kt)("p",null,'regex to match the password failure messages in the logfile. The host must be\nmatched by a group named "',(0,a.kt)("inlineCode",{parentName:"p"},"host"),'". The tag "',(0,a.kt)("inlineCode",{parentName:"p"},"<HOST>"),'" can be used for standard\nIP/hostname matching and is only an alias for ',(0,a.kt)("inlineCode",{parentName:"p"},"(?:::f{4,6}:)?(?P<host>[\\w\\-.^_]+)")),(0,a.kt)("p",null,"You can find some more explainations about how to make a regex here :\n",(0,a.kt)("a",{parentName:"p",href:"https://www.fail2ban.org/wiki/index.php/MANUAL_0_8#Filters"},"https://www.fail2ban.org/wiki/index.php/MANUAL_0_8#Filters")),(0,a.kt)("p",null,"Note that the logfile need to exist before to call this helper !!"),(0,a.kt)("p",null,"To validate your regex you can test with this command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"fail2ban-regex /var/log/YOUR_LOG_FILE_PATH /etc/fail2ban/filter.d/YOUR_APP.conf\n")),(0,a.kt)("p",null,"Requires YunoHost version 4.1.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/fail2ban#L64"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_remove_fail2ban_config"},"ynh_remove_fail2ban_config"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Remove the dedicated fail2ban config (jail and filter conf files)")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_remove_fail2ban_config")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.5.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/fail2ban#L119"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"getopts"},"GETOPTS"),(0,a.kt)("h2",{id:"hardware"},"HARDWARE"),(0,a.kt)("h3",{id:"ynh_get_ram"},"ynh_get_ram"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Get the total or free amount of RAM+swap on the system")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_get_ram [--free|--total] [--ignore_swap|--only_swap]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-f"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--free"),": Count free RAM+swap"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-t"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--total"),": Count total RAM+swap"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-s"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--ignore_swap"),": Ignore swap, consider only real RAM"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-o"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--only_swap"),": Ignore real RAM, consider only swap")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": the amount of free ram, in MB (MegaBytes)"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.8.1 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/hardware#L13"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_require_ram"},"ynh_require_ram"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Return 0 or 1 depending if the system has a given amount of RAM+swap free or total")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_require_ram --required=RAM [--free|--total] [--ignore_swap|--only_swap]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-r"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--required="),": The amount to require, in MB"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-f"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--free"),": Count free RAM+swap"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-t"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--total"),": Count total RAM+swap"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-s"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--ignore_swap"),": Ignore swap, consider only real RAM"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-o"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--only_swap"),": Ignore real RAM, consider only swap")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": 1 if the ram is under the requirement, 0 otherwise."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.8.1 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/hardware#L75"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"logging"},"LOGGING"),(0,a.kt)("h3",{id:"ynh_die"},"ynh_die"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Print a message to stderr and exit")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_die --message=MSG [--ret_code=RETCODE]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-m"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--message="),": Message to display"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-c"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--ret_code="),": Exit code to exit with")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.4.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/logging#L10"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_print_info"},"ynh_print_info"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Display a message in the 'INFO' logging category")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_print_info --message="Some message"')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-m"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--message="),": Message to display")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.2.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/logging#L30"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_print_warn"},"ynh_print_warn"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Print a warning on stderr")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_print_warn --message="Text to print"')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-m"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--message="),": The text to print")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.2.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/logging#L56"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_print_err"},"ynh_print_err"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Print an error on stderr")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_print_err --message="Text to print"')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-m"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--message="),": The text to print")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.2.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/logging#L73"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_exec_err"},"ynh_exec_err"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Execute a command and print the result as an error")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_exec_err your command and args")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"command"),": command to execute")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nNote that you should NOT quote the command but only prefix it with ynh_exec_err"),(0,a.kt)("p",null,"Requires YunoHost version 3.2.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/logging#L92"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_exec_warn"},"ynh_exec_warn"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Execute a command and print the result as a warning")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_exec_warn your command and args")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"command"),": command to execute")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nNote that you should NOT quote the command but only prefix it with ynh_exec_warn"),(0,a.kt)("p",null,"Requires YunoHost version 3.2.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/logging#L113"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_exec_warn_less"},"ynh_exec_warn_less"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Execute a command and force the result to be printed on stdout")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_exec_warn_less your command and args")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"command"),": command to execute")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nNote that you should NOT quote the command but only prefix it with ynh_exec_warn"),(0,a.kt)("p",null,"Requires YunoHost version 3.2.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/logging#L134"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_exec_quiet"},"ynh_exec_quiet"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Execute a command and redirect stdout in /dev/null")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_exec_quiet your command and args")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"command"),": command to execute")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nNote that you should NOT quote the command but only prefix it with ynh_exec_warn"),(0,a.kt)("p",null,"Requires YunoHost version 3.2.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/logging#L155"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_exec_fully_quiet"},"ynh_exec_fully_quiet"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Execute a command and redirect stdout and stderr in /dev/null")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_exec_quiet your command and args")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"command"),": command to execute")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nNote that you should NOT quote the command but only prefix it with ynh_exec_quiet"),(0,a.kt)("p",null,"Requires YunoHost version 3.2.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/logging#L176"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_script_progression"},"ynh_script_progression"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Print a progress bar showing the progression of an app script")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_script_progression --message=message [--weight=weight] [--time]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-m"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--message="),": The text to print"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-w"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--weight="),": The weight for this progression. This value is 1 by default. Use a bigger value for a longer part of the script."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-t"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--time"),": Print the execution time since the last call to this helper. Especially usefull to define weights. The execution time is given for the duration since the previous call. So the weight should be applied to this previous call."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-l"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--last"),": Use for the last call of the helper, to fill the progression bar.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.5.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/logging#L237"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_return"},"ynh_return"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Return data to the YunoHost core for later processing (to be used by special hooks like app config panel and core diagnosis)")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_return somedata")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.6.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/logging#L325"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"logrotate"},"LOGROTATE"),(0,a.kt)("h3",{id:"ynh_use_logrotate"},"ynh_use_logrotate"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Use logrotate to manage the logfile")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_use_logrotate [--logfile=/log/file] [--nonappend] [--specific_user=user/group]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-l"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--logfile="),": absolute path of logfile"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-n"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--nonappend"),": (optional) Replace the config file instead of appending this new config."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-u"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--specific_user="),": run logrotate as the specified user and group. If not specified logrotate is runned as root.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nIf no ",(0,a.kt)("inlineCode",{parentName:"p"},"--logfile")," is provided, ",(0,a.kt)("inlineCode",{parentName:"p"},"/var/log/$app")," will be used as default.\n",(0,a.kt)("inlineCode",{parentName:"p"},"logfile")," can point to a directory or a file."),(0,a.kt)("p",null,"It's possible to use this helper multiple times, each config will be added to\nthe same logrotate config file. Unless you use the option ",(0,a.kt)("inlineCode",{parentName:"p"},"--non-append")),(0,a.kt)("p",null,"Requires YunoHost version 2.6.4 or higher.\nRequires YunoHost version 3.2.0 or higher for the argument ",(0,a.kt)("inlineCode",{parentName:"p"},"--specific_user")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/logrotate#L18"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_remove_logrotate"},"ynh_remove_logrotate"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Remove the app's logrotate config.")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_remove_logrotate")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.6.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/logrotate#L109"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"multimedia"},"MULTIMEDIA"),(0,a.kt)("h3",{id:"ynh_multimedia_build_main_dir"},"ynh_multimedia_build_main_dir"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Initialize the multimedia directory system")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_multimedia_build_main_dir")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 4.2 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/multimedia#L11"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_multimedia_addfolder"},"ynh_multimedia_addfolder"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Add a directory in yunohost.multimedia")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_multimedia_addfolder --source_dir="source_dir" --dest_dir="dest_dir"')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-s"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--source_dir="),": Source directory - The real directory which contains your medias."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-d"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--dest_dir="),': Destination directory - The name and the place of the symbolic link, relative to "/home/yunohost.multimedia"')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),'\nThis "directory" will be a symbolic link to a existing directory.'),(0,a.kt)("p",null,"Requires YunoHost version 4.2 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/multimedia#L64"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_multimedia_addaccess"},"ynh_multimedia_addaccess"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Allow an user to have an write authorisation in multimedia directories")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_multimedia_addaccess user_name")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-u"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--user_name="),": The name of the user which gain this access.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 4.2 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/multimedia#L93"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"mysql"},"MYSQL"),(0,a.kt)("h3",{id:"ynh_mysql_connect_as"},"ynh_mysql_connect_as"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Open a connection as a user")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_mysql_connect_as --user=user --password=password [--database=database]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-u"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--user="),": the user name to connect as"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-p"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--password="),": the user password"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-d"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--database="),": the database to connect to")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Examples"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},'   ynh_mysql_connect_as --user="user" --password="pass" <<< "UPDATE ...;"')),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},'   ynh_mysql_connect_as --user="user" --password="pass" < /path/to/file.sql'))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/mysql#L15"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_mysql_execute_as_root"},"ynh_mysql_execute_as_root"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Execute a command as root user")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_mysql_execute_as_root --sql=sql [--database=database]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-s"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--sql="),": the SQL command to execute"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-d"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--database="),": the database to connect to")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/mysql#L36"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_mysql_execute_file_as_root"},"ynh_mysql_execute_file_as_root"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Execute a command from a file as root user")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_mysql_execute_file_as_root --file=file [--database=database]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-f"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--file="),": the file containing SQL commands"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-d"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--database="),": the database to connect to")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/mysql#L60"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_mysql_dump_db"},"ynh_mysql_dump_db"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Dump a database")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_mysql_dump_db --database=database")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-d"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--database="),": the database name to dump")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": The mysqldump output"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_mysql_dump_db --database=roundcube > ./dump.sql")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/mysql#L128"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_mysql_user_exists"},"ynh_mysql_user_exists"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Check if a mysql user exists")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_mysql_user_exists --user=user")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-u"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--user="),": the user for which to check existence")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": 0 if the user exists, 1 otherwise."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/mysql#L160"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_mysql_setup_db"},"ynh_mysql_setup_db"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Create a database, an user and its password. Then store the password in the app's config")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_mysql_setup_db --db_user=user --db_name=name [--db_pwd=pwd]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-u"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--db_user="),": Owner of the database"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-n"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--db_name="),": Name of the database"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-p"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--db_pwd="),": Password of the database. If not provided, a password will be generated")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nAfter executing this helper, the password of the created database will be available in ",(0,a.kt)("inlineCode",{parentName:"p"},"$db_pwd"),'\nIt will also be stored as "',(0,a.kt)("inlineCode",{parentName:"p"},"mysqlpwd"),'" into the app settings.'),(0,a.kt)("p",null,"Requires YunoHost version 2.6.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/mysql#L198"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_mysql_remove_db"},"ynh_mysql_remove_db"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Remove a database if it exists, and the associated user")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_mysql_remove_db --db_user=user --db_name=name")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-u"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--db_user="),": Owner of the database"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-n"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--db_name="),": Name of the database")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.6.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/mysql#L224"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"network"},"NETWORK"),(0,a.kt)("h3",{id:"ynh_find_port"},"ynh_find_port"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Find a free port and return it")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_find_port --port=begin_port")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-p"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--port="),": port to start to search")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": the port number"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"port=$(ynh_find_port --port=8080)")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.6.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/network#L12"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_port_available"},"ynh_port_available"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Test if a port is available")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_find_port --port=XYZ")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-p"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--port="),": port to check")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": 0 if the port is available, 1 if it is already used by another process."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_port_available --port=1234 || ynh_die --message="Port 1234 is needs to be available for this app"')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.8.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/network#L36"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_validate_ip4"},"ynh_validate_ip4"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Validate an IPv4 address")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_validate_ip4 --ip_address=ip_address")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-i"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--ip_address="),": the ipv4 address to check")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": 0 for valid ipv4 addresses, 1 otherwise"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_validate_ip4 111.222.333.444")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/network#L99"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_validate_ip6"},"ynh_validate_ip6"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Validate an IPv6 address")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_validate_ip6 --ip_address=ip_address")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-i"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--ip_address="),": the ipv6 address to check")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": 0 for valid ipv6 addresses, 1 otherwise"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_validate_ip6 2000:dead:beef::1")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/network#L119"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"nginx"},"NGINX"),(0,a.kt)("h3",{id:"ynh_add_nginx_config"},"ynh_add_nginx_config"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Create a dedicated nginx config")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_add_nginx_config")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nThis will use a template in ",(0,a.kt)("inlineCode",{parentName:"p"},"../conf/nginx.conf"),"\nSee the documentation of ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_add_config")," for a description of the template\nformat and how placeholders are replaced with actual variables."),(0,a.kt)("p",null,"Additionally, ynh_add_nginx_config will replace:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"#sub_path_only"),"      by empty string if ",(0,a.kt)("inlineCode",{parentName:"li"},"path_url")," is not ",(0,a.kt)("inlineCode",{parentName:"li"},"'/'")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"#root_path_only"),"     by empty string if ",(0,a.kt)("inlineCode",{parentName:"li"},"path_url"),"  ",(0,a.kt)("em",{parentName:"li"},"is"),"  ",(0,a.kt)("inlineCode",{parentName:"li"},"'/'"))),(0,a.kt)("p",null,"This allows to enable/disable specific behaviors dependenging on the install\nlocation"),(0,a.kt)("p",null,"Requires YunoHost version 4.1.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/nginx#L19"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_remove_nginx_config"},"ynh_remove_nginx_config"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Remove the dedicated nginx config")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_remove_nginx_config")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.7.2 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/nginx#L41"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_change_url_nginx_config"},"ynh_change_url_nginx_config"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Move / regen the nginx config in a change url context")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_change_url_nginx_config")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 11.1.9 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/nginx#L52"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"nodejs"},"NODEJS"),(0,a.kt)("h3",{id:"ynh_use_nodejs"},"ynh_use_nodejs"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Load the version of node for an app, and set variables.")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_use_nodejs")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\n",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_use_nodejs")," has to be used in any app scripts before using node for the first time.\nThis helper will provide alias and variables to use in your scripts."),(0,a.kt)("p",null,"To use npm or node, use the alias ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_npm")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_node"),"."),(0,a.kt)("p",null,"Those alias will use the correct version installed for the app.\nFor example: use ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_npm install")," instead of ",(0,a.kt)("inlineCode",{parentName:"p"},"npm install")),(0,a.kt)("p",null,"With ",(0,a.kt)("inlineCode",{parentName:"p"},"sudo")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_exec_as"),", use instead the fallback variables ",(0,a.kt)("inlineCode",{parentName:"p"},"$ynh_npm")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"$ynh_node"),"\nAnd propagate $PATH to sudo with $ynh_node_load_PATH\nExemple: ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_exec_as $app $ynh_node_load_PATH $ynh_npm install")),(0,a.kt)("p",null,"$PATH contains the path of the requested version of node.\nHowever, $PATH is duplicated into $node_PATH to outlast any manipulation of ",(0,a.kt)("inlineCode",{parentName:"p"},"$PATH"),"\nYou can use the variable ",(0,a.kt)("inlineCode",{parentName:"p"},"$ynh_node_load_PATH")," to quickly load your node version\nin $PATH for an usage into a separate script.\nExemple: $ynh_node_load_PATH $final_path/script_that_use_npm.sh`"),(0,a.kt)("p",null,"Finally, to start a nodejs service with the correct version, 2 solutions\nEither the app is dependent of node or npm, but does not called it directly.\nIn such situation, you need to load PATH :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'Environment="__NODE_ENV_PATH__"\nExecStart=__FINALPATH__/my_app\n')),(0,a.kt)("p",null,"You will replace ",(0,a.kt)("strong",{parentName:"p"},"NODE_ENV_PATH")," with $ynh_node_load_PATH."),(0,a.kt)("p",null,"Or node start the app directly, then you don't need to load the PATH variable"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"ExecStart=__YNH_NODE__ my_app run\n")),(0,a.kt)("p",null,"You will replace ",(0,a.kt)("strong",{parentName:"p"},"YNH_NODE")," with $ynh_node"),(0,a.kt)("p",null,"2 other variables are also available"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"$nodejs_path: The absolute path to node binaries for the chosen version."),(0,a.kt)("li",{parentName:"ul"},"$nodejs_version: Just the version number of node for this app. Stored as 'nodejs_version' in settings.yml.")),(0,a.kt)("p",null,"Requires YunoHost version 2.7.12 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/nodejs#L52"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_install_nodejs"},"ynh_install_nodejs"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Install a specific version of nodejs")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_install_nodejs --nodejs_version=nodejs_version")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-n"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--nodejs_version="),": Version of node to install. When possible, your should prefer to use major version number (e.g. 8 instead of 8.10.0). The crontab will then handle the update of minor versions when needed.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nynh_install_nodejs will install the version of node provided as argument by using n."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"n")," (Node version management) uses the ",(0,a.kt)("inlineCode",{parentName:"p"},"PATH")," variable to store the path of the version of node it is going to use.\nThat's how it changes the version"),(0,a.kt)("p",null,"Refer to ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_use_nodejs")," for more information about available commands and variables"),(0,a.kt)("p",null,"Requires YunoHost version 2.7.12 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/nodejs#L92"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_remove_nodejs"},"ynh_remove_nodejs"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Remove the version of node used by the app.")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_remove_nodejs")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nThis helper will check if another app uses the same version of node."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"If not, this version of node will be removed."),(0,a.kt)("li",{parentName:"ul"},"If no other app uses node, n will be also removed.")),(0,a.kt)("p",null,"Requires YunoHost version 2.7.12 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/nodejs#L165"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"permission"},"PERMISSION"),(0,a.kt)("h3",{id:"ynh_permission_create"},"ynh_permission_create"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Create a new permission for the app")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_permission_create --permission="permission" [--url="url"] [--additional_urls="second-url" [ "third-url" ]] [--auth_header=true|false]\n                                                       [--allowed=group1 [ group2 ]] [--label="label"] [--show_tile=true|false]\n                                                       [--protected=true|false]')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-p"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--permission="),': the name for the permission (by default a permission named "main" already exist)'),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-u"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--url="),": (optional) URL for which access will be allowed/forbidden. Note that if 'show_tile' is enabled, this URL will be the URL of the tile."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-A"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--additional_urls="),": (optional) List of additional URL for which access will be allowed/forbidden"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-h"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--auth_header="),": (optional) Define for the URL of this permission, if SSOwat pass the authentication header to the application. Default is true"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-a"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--allowed="),": (optional) A list of group/user to allow for the permission"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-l"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--label="),': (optional) Define a name for the permission. This label will be shown on the SSO and in the admin. Default is "APP_LABEL (permission name)".'),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-t"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--show_tile="),": (optional) Define if a tile will be shown in the SSO. If yes the name of the tile will be the 'label' parameter. Defaults to false for the permission different than 'main'."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-P"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--protected="),": (optional) Define if this permission is protected. If it is protected the administrator won't be able to add or remove the visitors group of this permission. Defaults to 'false'.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nExample 1: ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_permission_create --permission=admin --url=/admin --additional_urls=domain.tld/admin /superadmin --allowed=alice bob \\\n                                 --label="My app admin" --show_tile=true')),(0,a.kt)("p",null,"This example will create a new permission permission with this following effect:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"A tile named \"My app admin\" in the SSO will be available for the users alice and bob. This tile will point to the relative url '/admin'."),(0,a.kt)("li",{parentName:"ul"},"Only the user alice and bob will have the access to theses following url: /admin, domain.tld/admin, /superadmin")),(0,a.kt)("p",null,"Example 2:"),(0,a.kt)("p",null,'ynh_permission_create --permission=api --url=domain.tld/api --auth_header=false --allowed=visitors \\\n--label="MyApp API" --protected=true'),(0,a.kt)("p",null,"This example will create a new protected permission. So the admin won't be able to add/remove the visitors group of this permission.\nIn case of an API with need to be always public it avoid that the admin break anything.\nWith this permission all client will be allowed to access to the url 'domain.tld/api'.\nNote that in this case no tile will be show on the SSO.\nNote that the auth_header parameter is to 'false'. So no authentication header will be passed to the application.\nGenerally the API is requested by an application and enabling the auth_header has no advantage and could bring some issues in some case.\nSo in this case it's better to disable this option for all API."),(0,a.kt)("p",null,"If provided, 'url' or 'additional_urls' is assumed to be relative to the app domain/path if they\nstart with '/'.  For example:\n/                             -> domain.tld/app\n/admin                        -> domain.tld/app/admin\ndomain.tld/app/api            -> domain.tld/app/api"),(0,a.kt)("p",null,"'url' or 'additional_urls' can be treated as a PCRE (not lua) regex if it starts with \"re:\".\nFor example:\nre:/api/","[A-Z]",(0,a.kt)("em",{parentName:"p"},"$               -> domain.tld/app/api/","[A-Z]"),"$\nre:domain.tld/app/api/","[A-Z]",(0,a.kt)("em",{parentName:"p"},"$ -> domain.tld/app/api/","[A-Z]"),"$"),(0,a.kt)("p",null,"Note that globally the parameter 'url' and 'additional_urls' are same. The only difference is:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"'url' is only one url, 'additional_urls' can be a list of urls. There are no limitation of 'additional_urls'"),(0,a.kt)("li",{parentName:"ul"},"'url' is used for the url of tile in the SSO (if enabled with the 'show_tile' parameter)")),(0,a.kt)("p",null,"About the authentication header (auth_header parameter).\nThe SSO pass (by default) to the application theses following HTTP header (linked to the authenticated user) to the application:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'   - "Auth-User": username\n   - "Remote-User": username\n   - "Email": user email\n')),(0,a.kt)("p",null,"Generally this feature is usefull to authenticate automatically the user in the application but in some case the application don't work with theses header and theses header need to be disabled to have the application to work correctly.\nSee ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/issues/issues/1420"},"https://github.com/YunoHost/issues/issues/1420")," for more informations"),(0,a.kt)("p",null,"Requires YunoHost version 3.7.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/permission#L66"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_permission_delete"},"ynh_permission_delete"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Remove a permission for the app (note that when the app is removed all permission is automatically removed)")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_permission_delete --permission="permission"')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-p"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--permission="),': the name for the permission (by default a permission named "main" is removed automatically when the app is removed)')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_permission_delete --permission=editors")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.7.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/permission#L152"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_permission_exists"},"ynh_permission_exists"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Check if a permission exists")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_permission_exists --permission=permission\n| exit: Return 1 if the permission doesn't exist, 0 otherwise")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-p"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--permission="),": the permission to check")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.7.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/permission#L169"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_permission_url"},"ynh_permission_url"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Redefine the url associated to a permission")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_permission_url --permission "permission" [--url="url"] [--add_url="new-url" [ "other-new-url" ]] [--remove_url="old-url" [ "other-old-url" ]]\n                                                    [--auth_header=true|false] [--clear_urls]')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-p"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--permission="),': the name for the permission (by default a permission named "main" is removed automatically when the app is removed)'),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-u"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--url="),': (optional) URL for which access will be allowed/forbidden. Note that if you want to remove url you can pass an empty sting as arguments ("").'),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-a"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--add_url="),": (optional) List of additional url to add for which access will be allowed/forbidden."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-r"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--remove_url="),": (optional) List of additional url to remove for which access will be allowed/forbidden"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-h"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--auth_header="),": (optional) Define for the URL of this permission, if SSOwat pass the authentication header to the application"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-c"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--clear_urls"),": (optional) Clean all urls (url and additional_urls)")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.7.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/permission#L192"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_permission_update"},"ynh_permission_update"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Update a permission for the app")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_permission_update --permission "permission" [--add="group" ["group" ...]] [--remove="group" ["group" ...]]\n                                                       [--label="label"] [--show_tile=true|false] [--protected=true|false]')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-p"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--permission="),': the name for the permission (by default a permission named "main" already exist)'),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-a"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--add="),": the list of group or users to enable add to the permission"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-r"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--remove="),": the list of group or users to remove from the permission"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-l"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--label="),": (optional) Define a name for the permission. This label will be shown on the SSO and in the admin."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-t"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--show_tile="),": (optional) Define if a tile will be shown in the SSO"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-P"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--protected="),": (optional) Define if this permission is protected. If it is protected the administrator won't be able to add or remove the visitors group of this permission.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.7.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/permission#L260"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_permission_has_user"},"ynh_permission_has_user"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Check if a permission has an user")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_permission_has_user --permission=permission --user=user\n| exit: Return 1 if the permission doesn't have that user or doesn't exist, 0 otherwise")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-p"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--permission="),": the permission to check"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-u"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--user="),": the user seek in the permission")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_permission_has_user --permission=main --user=visitors")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.7.1 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/permission#L329"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_legacy_permissions_exists"},"ynh_legacy_permissions_exists"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Check if a legacy permissions exist")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_legacy_permissions_exists\n| exit: Return 1 if the permission doesn't exist, 0 otherwise")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 4.1.2 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/permission#L359"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_legacy_permissions_delete_all"},"ynh_legacy_permissions_delete_all"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Remove all legacy permissions")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_legacy_permissions_delete_all")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"if ynh_legacy_permissions_exists then ynh_legacy_permissions_delete_all # You can recreate the required permissions here with ynh_permission_create fi Requires YunoHost version 4.1.2 or higher.")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/permission#L379"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"php"},"PHP"),(0,a.kt)("h3",{id:"ynh_add_fpm_config"},"ynh_add_fpm_config"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Create a dedicated PHP-FPM config")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_add_fpm_config")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nCase 1 (recommended) : your provided a snippet conf/extra_php-fpm.conf"),(0,a.kt)("p",null,"The actual PHP configuration will be automatically generated,\nand your extra_php-fpm.conf will be appended (typically contains PHP upload limits)"),(0,a.kt)("p",null,"The resulting configuration will be deployed to the appropriate place, /etc/php/$phpversion/fpm/pool.d/$app.conf"),(0,a.kt)("p",null,'Performance-related options in the PHP conf, such as :\npm.max_children, pm.start_servers, pm.min_spare_servers pm.max_spare_servers\nare computed from two parameters called "usage" and "footprint" which can be set to low/medium/high. (cf details below)'),(0,a.kt)("p",null,"If you wish to tweak those, please initialize the settings ",(0,a.kt)("inlineCode",{parentName:"p"},"fpm_usage")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"fpm_footprint"),"\n",(0,a.kt)("em",{parentName:"p"},"prior"),' to calling this helper. Otherwise, "low" will be used as a default for both values.'),(0,a.kt)("p",null,"Otherwise, if you want the user to have control over these, we encourage to create a config panel\n(which should ultimately be standardized by the core ...)"),(0,a.kt)("p",null,"Case 2 (deprecate) : you provided an entire conf/php-fpm.conf"),(0,a.kt)("p",null,"The configuration will be hydrated, replacing ",(0,a.kt)("strong",{parentName:"p"},"FOOBAR")," placeholders with $foobar values, etc."),(0,a.kt)("p",null,"The resulting configuration will be deployed to the appropriate place, /etc/php/$phpversion/fpm/pool.d/$app.conf"),(0,a.kt)("hr",null),(0,a.kt)("p",null,"fpm_footprint: Memory footprint of the service (low/medium/high).\nlow    - Less than 20 MB of RAM by pool.\nmedium - Between 20 MB and 40 MB of RAM by pool.\nhigh   - More than 40 MB of RAM by pool.\nN      - Or you can specify a quantitative footprint as MB by pool (use watch -n0.5 ps -o user,cmd,%cpu,rss -u APP)"),(0,a.kt)("p",null,"fpm_usage: Expected usage of the service (low/medium/high).\nlow    - Personal usage, behind the SSO.\nmedium - Low usage, few people or/and publicly accessible.\nhigh   - High usage, frequently visited website."),(0,a.kt)("p",null,"The footprint of the service will be used to defined the maximum footprint we can allow, which is half the maximum RAM.\nSo it will be used to defined 'pm.max_children'\nA lower value for the footprint will allow more children for 'pm.max_children'. And so for\n'pm.start_servers', 'pm.min_spare_servers' and 'pm.max_spare_servers' which are defined from the\nvalue of 'pm.max_children'\nNOTE: 'pm.max_children' can't exceed 4 times the number of processor's cores."),(0,a.kt)("p",null,"The usage value will defined the way php will handle the children for the pool.\nA value set as 'low' will set the process manager to 'ondemand'. Children will start only if the\nservice is used, otherwise no child will stay alive. This config gives the lower footprint when the\nservice is idle. But will use more proc since it has to start a child as soon it's used.\nSet as 'medium', the process manager will be at dynamic. If the service is idle, a number of children\nequal to pm.min_spare_servers will stay alive. So the service can be quick to answer to any request.\nThe number of children can grow if needed. The footprint can stay low if the service is idle, but\nnot null. The impact on the proc is a little bit less than 'ondemand' as there's always a few\nchildren already available.\nSet as 'high', the process manager will be set at 'static'. There will be always as many children as\n'pm.max_children', the footprint is important (but will be set as maximum a quarter of the maximum\nRAM) but the impact on the proc is lower. The service will be quick to answer as there's always many\nchildren ready to answer."),(0,a.kt)("p",null,"Requires YunoHost version 4.1.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/php#L70"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_remove_fpm_config"},"ynh_remove_fpm_config"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Remove the dedicated PHP-FPM config")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_remove_fpm_config")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.7.2 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/php#L281"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_composer_exec"},"ynh_composer_exec"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Execute a command with Composer")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_composer_exec [--phpversion=phpversion] [--workdir=$install_dir] --commands="commands"')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-v"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--phpversion"),": PHP version to use with composer"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-w"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--workdir"),": The directory from where the command will be executed. Default $install_dir or $final_path"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-c"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--commands"),": Commands to execute.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 4.2 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/php#L514"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_install_composer"},"ynh_install_composer"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Install and initialize Composer in the given directory")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_install_composer [--phpversion=phpversion] [--workdir=$install_dir] [--install_args="--optimize-autoloader"] [--composerversion=composerversion]')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-v"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--phpversion"),": PHP version to use with composer"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-w"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--workdir"),": The directory from where the command will be executed. Default $install_dir."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-a"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--install_args"),": Additional arguments provided to the composer install. Argument --no-dev already include"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-c"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--composerversion"),": Composer version to install")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 4.2 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/php#L546"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"postgresql"},"POSTGRESQL"),(0,a.kt)("h3",{id:"ynh_psql_connect_as"},"ynh_psql_connect_as"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Open a connection as a user")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_psql_connect_as --user=user --password=password [--database=database]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-u"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--user="),": the user name to connect as"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-p"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--password="),": the user password"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-d"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--database="),": the database to connect to")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Examples"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"   ynh_psql_connect_as 'user' 'pass' <<< \"UPDATE ...;\"")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"   ynh_psql_connect_as 'user' 'pass' < /path/to/file.sql"))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.5.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/postgresql#L18"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_psql_execute_as_root"},"ynh_psql_execute_as_root"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Execute a command as root user")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_psql_execute_as_root --sql=sql [--database=database]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-s"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--sql="),": the SQL command to execute"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-d"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--database="),": the database to connect to")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.5.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/postgresql#L39"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_psql_execute_file_as_root"},"ynh_psql_execute_file_as_root"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Execute a command from a file as root user")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_psql_execute_file_as_root --file=file [--database=database]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-f"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--file="),": the file containing SQL commands"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-d"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--database="),": the database to connect to")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.5.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/postgresql#L64"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_psql_dump_db"},"ynh_psql_dump_db"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Dump a database")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_psql_dump_db --database=database")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-d"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--database="),": the database name to dump")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": the psqldump output"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_psql_dump_db 'roundcube' > ./dump.sql")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.5.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/postgresql#L135"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_psql_user_exists"},"ynh_psql_user_exists"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Check if a psql user exists")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_psql_user_exists --user=user\n| exit: Return 1 if the user doesn't exist, 0 otherwise")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-u"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--user="),": the user for which to check existence")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.5.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/postgresql#L168"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_psql_database_exists"},"ynh_psql_database_exists"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Check if a psql database exists")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_psql_database_exists --database=database\n| exit: Return 1 if the database doesn't exist, 0 otherwise")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-d"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--database="),": the database for which to check existence")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.5.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/postgresql#L190"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_psql_setup_db"},"ynh_psql_setup_db"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Create a database, an user and its password. Then store the password in the app's config")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_psql_setup_db --db_user=user --db_name=name [--db_pwd=pwd]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-u"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--db_user="),": Owner of the database"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-n"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--db_name="),": Name of the database"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-p"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--db_pwd="),": Password of the database. If not provided, a password will be generated")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),'\nAfter executing this helper, the password of the created database will be available in $db_pwd\nIt will also be stored as "psqlpwd" into the app settings.'),(0,a.kt)("p",null,"Requires YunoHost version 2.7.13 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/postgresql#L234"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_psql_remove_db"},"ynh_psql_remove_db"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Remove a database if it exists, and the associated user")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_psql_remove_db --db_user=user --db_name=name")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-u"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--db_user="),": Owner of the database"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-n"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--db_name="),": Name of the database")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.7.13 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/postgresql#L265"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"setting"},"SETTING"),(0,a.kt)("h3",{id:"ynh_app_setting_get"},"ynh_app_setting_get"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Get an application setting")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_app_setting_get --app=app --key=key")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-a"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--app="),": the application id"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-k"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--key="),": the setting to get")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/setting#L10"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_app_setting_set"},"ynh_app_setting_set"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Set an application setting")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_app_setting_set --app=app --key=key --value=value")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-a"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--app="),": the application id"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-k"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--key="),": the setting name to set"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-v"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--value="),": the setting value to set")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/setting#L36"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_app_setting_delete"},"ynh_app_setting_delete"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Delete an application setting")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_app_setting_delete --app=app --key=key")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-a"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--app="),": the application id"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-k"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--key="),": the setting to delete")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/setting#L62"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_webpath_available"},"ynh_webpath_available"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Check availability of a web path")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_webpath_available --domain=domain --path_url=path")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-d"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--domain="),": the domain/host of the url"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-p"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--path_url="),": the web path to check the availability of")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_webpath_available --domain=some.domain.tld --path_url=/coffee")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.6.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/setting#L123"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_webpath_register"},"ynh_webpath_register"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Register/book a web path for an app")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_webpath_register --app=app --domain=domain --path_url=path")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-a"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--app="),": the app for which the domain should be registered"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-d"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--domain="),": the domain/host of the web path"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-p"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--path_url="),": the web path to be registered")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_webpath_register --app=wordpress --domain=some.domain.tld --path_url=/coffee")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.6.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/setting#L145"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"string"},"STRING"),(0,a.kt)("h3",{id:"ynh_string_random"},"ynh_string_random"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Generate a random string")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_string_random [--length=string_length]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-l"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--length="),": the string length to generate (default: 24)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-f"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--filter="),": the kind of characters accepted in the output (default: 'A-Za-z0-9')")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": the generated string"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"pwd=$(ynh_string_random --length=8)")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/string#L13"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_replace_string"},"ynh_replace_string"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Substitute/replace a string (or expression) by another in a file")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_replace_string --match_string=match_string --replace_string=replace_string --target_file=target_file")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-m"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--match_string="),": String to be searched and replaced in the file"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-r"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--replace_string="),": String that will replace matches"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-f"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--target_file="),": File in which the string will be replaced.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nAs this helper is based on sed command, regular expressions and references to\nsub-expressions can be used (see sed manual page for more information)"),(0,a.kt)("p",null,"Requires YunoHost version 2.6.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/string#L40"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_replace_special_string"},"ynh_replace_special_string"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Substitute/replace a special string by another in a file")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_replace_special_string --match_string=match_string --replace_string=replace_string --target_file=target_file")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-m"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--match_string="),": String to be searched and replaced in the file"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-r"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--replace_string="),": String that will replace matches"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-t"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--target_file="),": File in which the string will be replaced.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nThis helper will use ynh_replace_string, but as you can use special\ncharacters, you can't use some regular expressions and sub-expressions."),(0,a.kt)("p",null,"Requires YunoHost version 2.7.7 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/string#L71"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_sanitize_dbid"},"ynh_sanitize_dbid"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Sanitize a string intended to be the name of a database")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_sanitize_dbid --db_name=name")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-n"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--db_name="),": name to correct/sanitize")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": the corrected name"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"dbname=$(ynh_sanitize_dbid $app)")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nUnderscorify the string (replace - and . by _)"),(0,a.kt)("p",null,"Requires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/string#L103"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"systemd"},"SYSTEMD"),(0,a.kt)("h3",{id:"ynh_add_systemd_config"},"ynh_add_systemd_config"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Create a dedicated systemd config")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_add_systemd_config [--service=service] [--template=template]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-s"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--service="),": Service name (optionnal, ",(0,a.kt)("inlineCode",{parentName:"li"},"$app")," by default)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-t"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--template="),": Name of template file (optionnal, this is 'systemd' by default, meaning ",(0,a.kt)("inlineCode",{parentName:"li"},"../conf/systemd.service")," will be used as template)")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nThis will use the template ",(0,a.kt)("inlineCode",{parentName:"p"},"../conf/<templatename>.service"),"."),(0,a.kt)("p",null,"See the documentation of ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_add_config")," for a description of the template\nformat and how placeholders are replaced with actual variables."),(0,a.kt)("p",null,"Requires YunoHost version 4.1.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/systemd#L15"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_remove_systemd_config"},"ynh_remove_systemd_config"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Remove the dedicated systemd config")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_remove_systemd_config [--service=service]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-s"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--service="),": Service name (optionnal, $app by default)")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.7.2 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/systemd#L38"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_systemd_action"},"ynh_systemd_action"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Start (or other actions) a service,  print a log in case of failure and optionnaly wait until the service is completely started")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_systemd_action [--service_name=service_name] [--action=action] [ [--line_match="line to match"] [--log_path=log_path] [--timeout=300] [--length=20] ]')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-n"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--service_name="),": Name of the service to start. Default : ",(0,a.kt)("inlineCode",{parentName:"li"},"$app")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-a"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--action="),": Action to perform with systemctl. Default: start"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-l"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--line_match="),": Line to match - The line to find in the log to attest the service have finished to boot. If not defined it don't wait until the service is completely started."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-p"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--log_path="),": Log file - Path to the log file. Default : ",(0,a.kt)("inlineCode",{parentName:"li"},"/var/log/$app/$app.log")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-t"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--timeout="),": Timeout - The maximum time to wait before ending the watching. Default : 300 seconds."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-e"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--length="),": Length of the error log displayed for debugging : Default : 20")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.5.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/systemd#L67"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"user"},"USER"),(0,a.kt)("h3",{id:"ynh_user_exists"},"ynh_user_exists"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Check if a YunoHost user exists")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_user_exists --username=username")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-u"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--username="),": the username to check")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": 0 if the user exists, 1 otherwise."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_user_exists 'toto' || echo \"User does not exist\"")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/user#L12"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_user_get_info"},"ynh_user_get_info"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Retrieve a YunoHost user information")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_user_get_info --username=username --key=key")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-u"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--username="),": the username to retrieve info from"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-k"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--key="),": the key to retrieve")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": the value associate to that key"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'mail=$(ynh_user_get_info --username="toto" --key=mail)')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/user#L33"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_user_list"},"ynh_user_list"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Get the list of YunoHost users")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_user_list")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": one username per line as strings"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"for u in $(ynh_user_list); do ... ; done")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.4.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/user#L53"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_system_user_exists"},"ynh_system_user_exists"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Check if a user exists on the system")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_system_user_exists --username=username")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-u"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--username="),": the username to check")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": 0 if the user exists, 1 otherwise."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.2.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/user#L64"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_system_group_exists"},"ynh_system_group_exists"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Check if a group exists on the system")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_system_group_exists --group=group")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-g"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--group="),": the group to check")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": 0 if the group exists, 1 otherwise."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.5.0.2 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/user#L82"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_system_user_create"},"ynh_system_user_create"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Create a system user")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_system_user_create --username=user_name [--home_dir=home_dir] [--use_shell] [--groups="group1 group2"]')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-u"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--username="),": Name of the system user that will be create"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-h"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--home_dir="),": Path of the home dir for the user. Usually the final path of the app. If this argument is omitted, the user will be created without home"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-s"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--use_shell"),": Create a user using the default login shell if present. If this argument is omitted, the user will be created with /usr/sbin/nologin shell"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-g"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--groups"),": Add the user to system groups. Typically meant to add the user to the ssh.app / sftp.app group (e.g. for borgserver, my_webapp)")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nCreate a nextcloud user with no home directory and /usr/sbin/nologin login shell (hence no login capability) :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"ynh_system_user_create --username=nextcloud\n")),(0,a.kt)("p",null,"Create a discourse user using /var/www/discourse as home directory and the default login shell :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"ynh_system_user_create --username=discourse --home_dir=/var/www/discourse --use_shell\n")),(0,a.kt)("p",null,"Requires YunoHost version 2.6.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/user#L111"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_system_user_delete"},"ynh_system_user_delete"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Delete a system user")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_system_user_delete --username=user_name")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-u"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--username="),": Name of the system user that will be create")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.6.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/user#L153"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_exec_as"},"ynh_exec_as"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Execute a command as another user")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_exec_as $USER COMMAND [ARG ...]")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 4.1.7 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/user#L179"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"utils"},"UTILS"),(0,a.kt)("h3",{id:"ynh_abort_if_errors"},"ynh_abort_if_errors"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Exits if an error occurs during the execution of the script.")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_abort_if_errors")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nThis configure the rest of the script execution such that, if an error occurs\nor if an empty variable is used, the execution of the script stops immediately\nand a call to ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_clean_setup")," is triggered if it has been defined by your script."),(0,a.kt)("p",null,"Requires YunoHost version 2.6.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/utils#L61"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_setup_source"},"ynh_setup_source"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Download, check integrity, uncompress and patch the source from app.src")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_setup_source --dest_dir=dest_dir [--source_id=source_id] [--keep="file1 file2"] [--full_replace]')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-d"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--dest_dir="),": Directory where to setup sources"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-s"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--source_id="),": Name of the source, defaults to ",(0,a.kt)("inlineCode",{parentName:"li"},"main")," (when the sources resource exists in manifest.toml) or (legacy) ",(0,a.kt)("inlineCode",{parentName:"li"},"app")," otherwise"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-k"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--keep="),": Space-separated list of files/folders that will be backup/restored in $dest_dir, such as a config file you don't want to overwrite. For example 'conf.json secrets.json logs/'"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-r"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--full_replace="),": Remove previous sources before installing new sources")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null)),(0,a.kt)("h3",{id:"new-sources-resources"},"New 'sources' resources"),(0,a.kt)("p",null,"(See also the resources documentation which may be more complete?)"),(0,a.kt)("p",null,"This helper will read infos from the 'sources' resources in the manifest.toml of the app\nand expect a structure like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-toml"},'[resources.sources]\n    [resources.sources.main]\n    url = "https://some.address.to/download/the/app/archive"\n    sha256 = "0123456789abcdef"    # The sha256 sum of the asset obtained from the URL\n')),(0,a.kt)("h4",{id:"optional-flags"},"Optional flags"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},'format    = "tar.gz"/xz/bz2    # automatically guessed from the extension of the URL, but can be set explicitly. Will use `tar` to extract\n            "zip"              # automatically guessed from the extension of the URL, but can be set explicitly. Will use `unzip` to extract\n            "docker"           # useful to extract files from an already-built docker image (instead of rebuilding them locally). Will use `docker-image-extract` to extract\n            "whatever"         # an arbitrary value, not really meaningful except to imply that the file won\'t be extracted\n\nin_subdir = true    # default, there\'s an intermediate subdir in the archive before accessing the actual files\n            false   # sources are directly in the archive root\n            n       # (special cases) an integer representing a number of subdirs levels to get rid of\n\nextract   = true    # default if file is indeed an archive such as .zip, .tar.gz, .tar.bz2, ...\n          = false   # default if file \'format\' is not set and the file is not to be extracted because it is not an archive but a script or binary or whatever asset.\n                    #    in which case the file will only be `mv`ed to the location possibly renamed using the `rename` value\n\nrename    = "whatever_your_want"   # to be used for convenience when `extract` is false and the default name of the file is not practical\nplatform  = "linux/amd64"          # (defaults to "linux/$YNH_ARCH") to be used in conjonction with `format = "docker"` to specify which architecture to extract for\n')),(0,a.kt)("p",null,"You may also define assets url and checksum per-architectures such as:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-toml"},'[resources.sources]\n    [resources.sources.main]\n    amd64.url = "https://some.address.to/download/the/app/archive/when/amd64"\n    amd64.sha256 = "0123456789abcdef"\n    armhf.url = "https://some.address.to/download/the/app/archive/when/armhf"\n    armhf.sha256 = "fedcba9876543210"\n')),(0,a.kt)("p",null,'In which case ynh_setup_source --dest_dir="$install_dir" will automatically pick the appropriate source depending on the arch'),(0,a.kt)("h3",{id:"legacy-format-src"},"Legacy format '.src'"),(0,a.kt)("p",null,"This helper will read ",(0,a.kt)("inlineCode",{parentName:"p"},"conf/${source_id}.src"),", download and install the sources."),(0,a.kt)("p",null,"The src file need to contains:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"SOURCE_URL=Address to download the app archive\nSOURCE_SUM=Sha256 sum\nSOURCE_FORMAT=tar.gz\nSOURCE_IN_SUBDIR=false\nSOURCE_FILENAME=example.tar.gz\nSOURCE_EXTRACT=(true|false)\nSOURCE_PLATFORM=linux/arm64/v8\n")),(0,a.kt)("p",null,"The helper will:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Download the specific URL if there is no local archive"),(0,a.kt)("li",{parentName:"ul"},"Check the integrity with the specific sha256 sum"),(0,a.kt)("li",{parentName:"ul"},"Uncompress the archive to ",(0,a.kt)("inlineCode",{parentName:"li"},"$dest_dir"),".",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"If ",(0,a.kt)("inlineCode",{parentName:"li"},"in_subdir")," is true, the first level directory of the archive will be removed."),(0,a.kt)("li",{parentName:"ul"},"If ",(0,a.kt)("inlineCode",{parentName:"li"},"in_subdir")," is a numeric value, the N first level directories will be removed."))),(0,a.kt)("li",{parentName:"ul"},"Patches named ",(0,a.kt)("inlineCode",{parentName:"li"},"sources/patches/${src_id}-*.patch")," will be applied to ",(0,a.kt)("inlineCode",{parentName:"li"},"$dest_dir")),(0,a.kt)("li",{parentName:"ul"},"Extra files in ",(0,a.kt)("inlineCode",{parentName:"li"},"sources/extra_files/$src_id")," will be copied to dest_dir")),(0,a.kt)("p",null,"Requires YunoHost version 2.6.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/utils#L154"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_local_curl"},"ynh_local_curl"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Curl abstraction to help with POST requests to local pages (such as installation forms)")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_local_curl "page_uri" "key1=value1" "key2=value2" ...')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"page_uri"),": Path (relative to ",(0,a.kt)("inlineCode",{parentName:"li"},"$path_url"),") of the page where POST data will be sent"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"key1=value1"),": (Optionnal) POST key and corresponding value"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"key2=value2"),": (Optionnal) Another POST key and corresponding value"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"..."),": (Optionnal) More POST keys and values")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_local_curl "/install.php?installButton" "foo=$var1" "bar=$var2"')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nFor multiple calls, cookies are persisted between each call for the same app"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"$domain")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"$path_url")," should be defined externally (and correspond to the domain.tld and the /path (of the app?))"),(0,a.kt)("p",null,"Requires YunoHost version 2.6.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/utils#L397"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_add_config"},"ynh_add_config"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Create a dedicated config file from a template")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_add_config --template="template" --destination="destination"')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-t"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--template="),": Template config file to use"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-d"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--destination="),": Destination of the config file")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Examples"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},'   ynh_add_config --template=".env" --destination="$install_dir/.env" use the template file "../conf/.env"')),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},'   ynh_add_config --template="/etc/nginx/sites-available/default" --destination="etc/nginx/sites-available/mydomain.conf"'))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nThe template can be by default the name of a file in the conf directory\nof a YunoHost Package, a relative path or an absolute path."),(0,a.kt)("p",null,"The helper will use the template ",(0,a.kt)("inlineCode",{parentName:"p"},"template")," to generate a config file\n",(0,a.kt)("inlineCode",{parentName:"p"},"destination")," by replacing the following keywords with global variables\nthat should be defined before calling this helper :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"  __PATH__                by $path_url\n  __NAME__                by $app\n  __NAMETOCHANGE__        by $app\n  __USER__                by $app\n  __FINALPATH__           by $final_path\n  __PHPVERSION__          by $YNH_PHP_VERSION (packaging v1 only, packaging v2 uses phpversion setting implicitly set by apt resource)\n  __YNH_NODE_LOAD_PATH__  by $ynh_node_load_PATH\n")),(0,a.kt)("p",null,"And any dynamic variables that should be defined before calling this helper like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"  __DOMAIN__   by $domain\n  __APP__      by $app\n  __VAR_1__    by $var_1\n  __VAR_2__    by $var_2\n")),(0,a.kt)("p",null,"The helper will verify the checksum and backup the destination file\nif it's different before applying the new template."),(0,a.kt)("p",null,"And it will calculate and store the destination file checksum\ninto the app settings when configuration is done."),(0,a.kt)("p",null,"Requires YunoHost version 4.1.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/utils#L481"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_read_var_in_file"},"ynh_read_var_in_file"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Get a value from heterogeneous file (yaml, json, php, python...)")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_read_var_in_file --file=PATH --key=KEY")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-f"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--file="),": the path to the file"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-k"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--key="),": the key to get")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nThis helpers match several var affectation use case in several languages\nWe don't use jq or equivalent to keep comments and blank space in files\nThis helpers work line by line, it is not able to work correctly\nif you have several identical keys in your files"),(0,a.kt)("p",null,"Example of line this helpers can managed correctly\n.yml\ntitle: YunoHost documentation\nemail: '",(0,a.kt)("a",{parentName:"p",href:"mailto:yunohost@yunohost.org"},"yunohost@yunohost.org"),'\'\n.json\n"theme": "colib\'ris",\n"port": 8102\n"some_boolean":     false,\n"user": null\n.ini\nsome_boolean = On\naction = "Clear"\nport = 20\n.php\n$user=\nuser => 20\n.py\nUSER = 8102\nuser = \'',(0,a.kt)("a",{parentName:"p",href:"https://donate.local'"},"https://donate.local'"),"\nCUSTOM","['user']"," = 'YunoHost'"),(0,a.kt)("p",null,"Requires YunoHost version 4.3 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/utils#L635"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_write_var_in_file"},"ynh_write_var_in_file"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Set a value into heterogeneous file (yaml, json, php, python...)")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_write_var_in_file --file=PATH --key=KEY --value=VALUE")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-f"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--file="),": the path to the file"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-k"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--key="),": the key to set"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-v"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--value="),": the value to set")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 4.3 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/utils#L712"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_get_debian_release"},"ynh_get_debian_release"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Fetch the Debian release codename")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_get_debian_release")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": The Debian release codename (i.e. jessie, stretch, ...)"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.7.12 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/utils#L827"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_secure_remove"},"ynh_secure_remove"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Remove a file or a directory securely")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_secure_remove --file=path_to_remove")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-f"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--file="),": File or directory to remove")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 2.6.4 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/utils#L858"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_read_manifest"},"ynh_read_manifest"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Read the value of a key in a ynh manifest file")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_read_manifest --manifest="manifest.json" --key="key"')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-m"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--manifest="),": Path of the manifest to read"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-k"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--key="),": Name of the key to find")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": the value associate to that key"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nRequires YunoHost version 3.5.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/utils#L892"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_app_upstream_version"},"ynh_app_upstream_version"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Read the upstream version from the manifest or `$YNH_APP_MANIFEST_VERSION`")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_app_upstream_version [--manifest="manifest.json"]')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-m"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--manifest="),": Path of the manifest to read")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": the version number of the upstream app"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nIf the ",(0,a.kt)("inlineCode",{parentName:"p"},"manifest")," is not specified, the envvar ",(0,a.kt)("inlineCode",{parentName:"p"},"$YNH_APP_MANIFEST_VERSION")," will be used."),(0,a.kt)("p",null,"The version number in the manifest is defined by ",(0,a.kt)("inlineCode",{parentName:"p"},"<upstreamversion>~ynh<packageversion>"),"."),(0,a.kt)("p",null,"For example, if the manifest contains ",(0,a.kt)("inlineCode",{parentName:"p"},"4.3-2~ynh3")," the function will return ",(0,a.kt)("inlineCode",{parentName:"p"},"4.3-2")),(0,a.kt)("p",null,"Requires YunoHost version 3.5.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/utils#L935"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_app_package_version"},"ynh_app_package_version"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Read package version from the manifest")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},'ynh_app_package_version [--manifest="manifest.json"]')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"-m"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"--manifest="),": Path of the manifest to read")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": the version number of the package"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nThe version number in the manifest is defined by ",(0,a.kt)("inlineCode",{parentName:"p"},"<upstreamversion>~ynh<packageversion>"),"."),(0,a.kt)("p",null,"For example, if the manifest contains ",(0,a.kt)("inlineCode",{parentName:"p"},"4.3-2~ynh3")," the function will return ",(0,a.kt)("inlineCode",{parentName:"p"},"3")),(0,a.kt)("p",null,"Requires YunoHost version 3.5.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/utils#L964"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_check_app_version_changed"},"ynh_check_app_version_changed"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Checks the app version to upgrade with the existing app version and returns:")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_check_app_version_changed")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"UPGRADE_APP")," if the upstream version changed, ",(0,a.kt)("inlineCode",{parentName:"p"},"UPGRADE_PACKAGE")," otherwise."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nThis helper should be used to avoid an upgrade of an app, or the upstream part\nof it, when it's not needed"),(0,a.kt)("p",null,"You can force an upgrade, even if the package is up to date, with the ",(0,a.kt)("inlineCode",{parentName:"p"},"--force")," (or ",(0,a.kt)("inlineCode",{parentName:"p"},"-F"),") argument :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"sudo yunohost app upgrade <appname> --force\n")),(0,a.kt)("p",null,"Requires YunoHost version 3.5.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/utils#L989"},"Dude, show me the code!")))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"ynh_compare_current_package_version"},"ynh_compare_current_package_version"),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("i",null,"Compare the current package version against another version given as an argument.")),(0,a.kt)("div",null,(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Usage"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_compare_current_package_version --comparison (lt|le|eq|ne|ge|gt) --version <X~ynhY>")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--comparison"),": Comparison type. Could be : ",(0,a.kt)("inlineCode",{parentName:"li"},"lt")," (lower than), ",(0,a.kt)("inlineCode",{parentName:"li"},"le")," (lower or equal), ",(0,a.kt)("inlineCode",{parentName:"li"},"eq")," (equal), ",(0,a.kt)("inlineCode",{parentName:"li"},"ne")," (not equal), ",(0,a.kt)("inlineCode",{parentName:"li"},"ge")," (greater or equal), ",(0,a.kt)("inlineCode",{parentName:"li"},"gt")," (greater than)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--version"),": The version to compare. Need to be a version in the yunohost package version type (like ",(0,a.kt)("inlineCode",{parentName:"li"},"2.3.1~ynh4"),")")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),": 0 if the evaluation is true, 1 if false."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"ynh_compare_current_package_version --comparison lt --version 2.3.2~ynh1")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Details"),":",(0,a.kt)("br",null),"\nThis helper is usually used when we need to do some actions only for some old package versions."),(0,a.kt)("p",null,"Generally you might probably use it as follow in the upgrade script :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"if ynh_compare_current_package_version --comparison lt --version 2.3.2~ynh1\nthen\n    # Do something that is needed for the package version older than 2.3.2~ynh1\nfi\n")),(0,a.kt)("p",null,"Requires YunoHost version 3.8.0 or higher."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/465f6da5cd4d716bbcb802dfd742114083034235/helpers/utils#L1019"},"Dude, show me the code!")))),(0,a.kt)("hr",null))}h.isMDXComponent=!0}}]);