"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([[9878],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>c});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),u=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=u(e.components);return o.createElement(l.Provider,{value:t},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},h=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=u(n),h=a,c=m["".concat(l,".").concat(h)]||m[h]||d[h]||i;return n?o.createElement(c,r(r({ref:t},p),{},{components:n})):o.createElement(c,r({ref:t},p))}));function c(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[m]="string"==typeof e?e:a,r[1]=s;for(var u=2;u<i;u++)r[u]=n[u];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}h.displayName="MDXCreateElement"},53138:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var o=n(87462),a=(n(67294),n(3905));const i={title:"Contributing to the YunoHost core",template:"docs",taxonomy:{category:"docs"},routes:{default:"/dev"}},r=void 0,s={unversionedId:"contribute/dev/dev",id:"contribute/dev/dev",title:"Contributing to the YunoHost core",description:"You wish to add a new feature in the YunoHost core, but don't know how to",source:"@site/docs/06.contribute/15.dev/15.dev.md",sourceDirName:"06.contribute/15.dev",slug:"/contribute/dev/",permalink:"/yunodocusaurus/fr/docs/contribute/dev/",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/06.contribute/15.dev/15.dev.md",tags:[],version:"current",sidebarPosition:15,frontMatter:{title:"Contributing to the YunoHost core",template:"docs",taxonomy:{category:"docs"},routes:{default:"/dev"}},sidebar:"tutorialSidebar",previous:{title:"General scope of variables",permalink:"/yunodocusaurus/fr/docs/contribute/packaging_apps/resources/shell_variables_scope"},next:{title:"How is used the main domain",permalink:"/yunodocusaurus/fr/docs/contribute/dev/maindomain"}},l={},u=[{value:"Setting up a development environment",id:"setting-up-a-development-environment",level:3},{value:"Overview of the 4 main pieces of YunoHost",id:"overview-of-the-4-main-pieces-of-yunohost",level:3},{value:"Moulinette",id:"moulinette",level:4},{value:"YunoHost",id:"yunohost",level:4},{value:"SSOwat",id:"ssowat",level:4},{value:"YunoHost-admin",id:"yunohost-admin",level:4},{value:"Working on the YunoHost Python/CLI core",id:"working-on-the-yunohost-pythoncli-core",level:3},{value:"Helpers / coding style",id:"helpers--coding-style",level:5},{value:"Working on the YunoHost web administration interface",id:"working-on-the-yunohost-web-administration-interface",level:3},{value:"Don&#39;t forget",id:"dont-forget",level:5},{value:"Your feature is ready and you want it to be integrated in YunoHost",id:"your-feature-is-ready-and-you-want-it-to-be-integrated-in-yunohost",level:3}],p={toc:u},m="wrapper";function d(e){let{components:t,...n}=e;return(0,a.kt)(m,(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"You wish to add a new feature in the YunoHost core, but don't know how to\nproceed? This guide takes you through the various steps of the development and\ncontribution process. "),(0,a.kt)("p",null,"If you're looking for stuff to implement or fix, the bug-tracker is\n",(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/issues/issues"},"here"),"!"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Come say hi to us in the ",(0,a.kt)("a",{parentName:"strong",href:"/chat_rooms"},"dev chat room")),"!"),(0,a.kt)("h3",{id:"setting-up-a-development-environment"},"Setting up a development environment"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Use ",(0,a.kt)("a",{parentName:"strong",href:"https://github.com/YunoHost/ynh-dev"},"ynh-dev"))," (see the README) to\nsetup a development environment - locally in a virtual machine, or on a VPS.\nThis will setup a working YunoHost instance, using directly the Git repositories\n(with symlinks). That way, you will be able to edit files, test your changes in real\ntime, commit stuff and push/pull directly from your development environment.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Implement and test your feature"),". Depending on what you want to develop, you\nwill want to:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Python/CLI core"),": work in ",(0,a.kt)("inlineCode",{parentName:"li"},"/ynh-dev/yunohost/")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Web administration interface"),": work in ",(0,a.kt)("inlineCode",{parentName:"li"},"/ynh-dev/yunohost-admin/")),(0,a.kt)("li",{parentName:"ul"},"You can also work on the other projects on which YunoHost is built\n(SSOwat, Moulinette) in similar ways")))),(0,a.kt)("h3",{id:"overview-of-the-4-main-pieces-of-yunohost"},"Overview of the 4 main pieces of YunoHost"),(0,a.kt)("h4",{id:"moulinette"},"Moulinette"),(0,a.kt)("p",null,'It is a small "homemade" framework. ',(0,a.kt)("a",{parentName:"p",href:"https://moulinette.readthedocs.io/en/latest/actionsmap.html"},"Its major role"),"\nis to allow us to build both a web API and a command-line API from the same\nPython code thanks to a YAML schema which we call\n",(0,a.kt)("a",{parentName:"p",href:"https://github.com/YunoHost/yunohost/blob/dev/share/actionsmap.yml"},"the actionmap"),"."),(0,a.kt)("p",null,"It handles other mechanisms like authentication, internationalization and\nsmall technical utilitary functions (e.g. reading/writing JSON)."),(0,a.kt)("p",null,"Moulinette has its own documentation available ",(0,a.kt)("a",{parentName:"p",href:"https://moulinette.readthedocs.io/en/latest/"},"here"),"."),(0,a.kt)("h4",{id:"yunohost"},"YunoHost"),(0,a.kt)("p",null,"This piece is the very core of YunoHost. It contains:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/YunoHost/yunohost/tree/dev/src"},"the Python code")," that manages users, domains, apps, services and other things"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/YunoHost/yunohost/tree/dev/helpers"},"bash helpers")," mainly used by application packagers to package applications"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/YunoHost/yunohost/tree/dev/hooks"},"hooks")," and ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/YunoHost/yunohost/tree/dev/conf"},"templates")," that are used to configure the various pieces of the ecosystem such as NGINX, Postfix..."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/YunoHost/yunohost/tree/dev/locales"},"internationalized strings")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/YunoHost/yunohost/tree/dev/tests"},"tests"))),(0,a.kt)("h4",{id:"ssowat"},"SSOwat"),(0,a.kt)("p",null,"This is the single sign-on system of YunoHost. It both contains:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/YunoHost/ssowat"},"Lua scripts"),' that are directly interfaced with NGINX and handle all the "technical" aspects of authentication and route accesses'),(0,a.kt)("li",{parentName:"ul"},"the web ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/YunoHost/SSOwat/tree/dev/portal"},"user portal")," which is the interface used by YunoHost's end users to log in and browse installed apps")),(0,a.kt)("p",null,"SSOwat is configured through ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/ssowat/conf.json")," which is generated by YunoHost."),(0,a.kt)("h4",{id:"yunohost-admin"},"YunoHost-admin"),(0,a.kt)("p",null,"It is an ",(0,a.kt)("em",{parentName:"p"},"optional")," dependency of YunoHost and corresponds to an interface for the web API created by YunoHost and Moulinette (c.f. the ",(0,a.kt)("inlineCode",{parentName:"p"},"yunohost-api")," service)."),(0,a.kt)("p",null,"It essentially contains:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/YunoHost/yunohost-admin/tree/dev/app/src/views"},"view templates")),(0,a.kt)("li",{parentName:"ul"},"corresponding ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/YunoHost/yunohost-admin/tree/dev/src/js/yunohost/controllers"},"JavaScript controllers")," that interact with the YunoHost API"),(0,a.kt)("li",{parentName:"ul"},"and ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/YunoHost/yunohost-admin/tree/dev/app/src/i18n/locales"},"internationalized strings"))),(0,a.kt)("h3",{id:"working-on-the-yunohost-pythoncli-core"},"Working on the YunoHost Python/CLI core"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Work in ",(0,a.kt)("inlineCode",{parentName:"p"},"/ynh-dev/yunohost/"),".")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Run ",(0,a.kt)("inlineCode",{parentName:"p"},"cd /ynh_dev/ && ./ynh-dev use-git yunohost"),".")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"The actionsmap file (",(0,a.kt)("inlineCode",{parentName:"p"},"data/actionsmap/yunohost.yml"),") defines the various\ncategories, actions and arguments of the yunohost CLI. Define how you want\nusers to use your feature, and add/edit the corresponding categories, actions\nand arguments. For example in ",(0,a.kt)("inlineCode",{parentName:"p"},"yunohost domain add some.domain.tld"),", the\ncategory is ",(0,a.kt)("inlineCode",{parentName:"p"},"domain"),", the action is ",(0,a.kt)("inlineCode",{parentName:"p"},"add"),", and ",(0,a.kt)("inlineCode",{parentName:"p"},"some.domain.tld")," is an\nargument.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Moulinette will automatically map commands in the actionsmap to Python\nfunctions (and their arguments) located in ",(0,a.kt)("inlineCode",{parentName:"p"},"src/yunohost/"),". For example, typing\n",(0,a.kt)("inlineCode",{parentName:"p"},"yunohost domain add some.domain.tld")," will call the function\n",(0,a.kt)("inlineCode",{parentName:"p"},"domain_add(domainName)")," in ",(0,a.kt)("inlineCode",{parentName:"p"},"domain.py"),", with the argument ",(0,a.kt)("inlineCode",{parentName:"p"},"domainName")," equal\nto ",(0,a.kt)("inlineCode",{parentName:"p"},'"some.domain.tld"'),"."))),(0,a.kt)("h5",{id:"helpers--coding-style"},"Helpers / coding style"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"To handle exceptions, you should raise some ",(0,a.kt)("inlineCode",{parentName:"p"},"YunohostError()"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"To help with internationalizing the messages, use ",(0,a.kt)("inlineCode",{parentName:"p"},"m18n.n('some-message-id')"),"\nand put your string in ",(0,a.kt)("inlineCode",{parentName:"p"},"locales/en.json"),". You can also put arguments and use\nthem in the string with ",(0,a.kt)("inlineCode",{parentName:"p"},"{{some-argument:s}}"),". Don't edit other locales files,\nthis will be done using ",(0,a.kt)("a",{parentName:"p",href:"https://translate.yunohost.org/"},"weblate")," !")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"YunoHost tries to follow the ",(0,a.kt)("a",{parentName:"p",href:"http://pep8.org/"},"pep8")," coding style. Tools\nexist to automatically check conformity.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},'Name of "private" functions should start with a ',(0,a.kt)("inlineCode",{parentName:"p"},"_")))),(0,a.kt)("h3",{id:"working-on-the-yunohost-web-administration-interface"},"Working on the YunoHost web administration interface"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Work in ",(0,a.kt)("inlineCode",{parentName:"p"},"/ynh-dev/yunohost-admin/src/"),".")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Run ",(0,a.kt)("inlineCode",{parentName:"p"},"cd /ynh-dev && ./ynh-dev use-git yunohost-admin"),". It launches gulp, such as each\ntime you modify sources, it recompiles the code and you can use it by\nrefreshing (Ctrl+F5) your web administration. To stop the command, just do Ctrl+C.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"The web interface uses the API to interact with YunoHost. The API\ncommands/requests are also defined via the actionsmap. For instance, accessing\nthe page ",(0,a.kt)("inlineCode",{parentName:"p"},"https://domain.tld/yunohost/api/users")," corresponds to a ",(0,a.kt)("inlineCode",{parentName:"p"},"GET\n/users")," requests on the YunoHost API. It is mapped to the function\n",(0,a.kt)("inlineCode",{parentName:"p"},"user_list()"),". Accessing the URL should display the JSON returned by this\nfunction. 'GET' requests are typically meant to ask information to the server.\n'POST' requests are meant to ask the server to edit/change some information,\nor to execute some actions.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"js/yunohost/controllers")," contains the JavaScript parts,\nand define which requests to make to the API when loading a specific page of\nthe interface, and how to process the data to generate the page, using\ntemplates.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"views")," contains the various templates for the pages of the interface. In the\ntemplate, data coming from the JavaScript part can be used with the syntax\n",(0,a.kt)("inlineCode",{parentName:"p"},"{{some-variable}}"),", which will be replaced when building/accessing the page.\nIt is also possible to have conditions using the\n",(0,a.kt)("a",{parentName:"p",href:"http://handlebarsjs.com"},"handlebars.js")," syntax: ",(0,a.kt)("inlineCode",{parentName:"p"},"{{#if\nsome-variable}}<p>Some conditional HTML code here !</p>{{/if}}"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"For internationalized strings, use ",(0,a.kt)("inlineCode",{parentName:"p"},"y18n.t('some-string-code')")," in the\nJavaScript, or ",(0,a.kt)("inlineCode",{parentName:"p"},"{{t 'some-string-code'}}")," in the HTML template, and put your\nstring in ",(0,a.kt)("inlineCode",{parentName:"p"},"locales/en.json"),". Don't edit other locales files,\nthis will be done using ",(0,a.kt)("a",{parentName:"p",href:"https://translate.yunohost.org/"},"Weblate"),"!"))),(0,a.kt)("h5",{id:"dont-forget"},"Don't forget"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Each time you edit the actionsmap or the Python code, you should restart the YunoHost api:\n",(0,a.kt)("inlineCode",{parentName:"p"},"systemctl restart yunohost-api"),"\n(You'll need to retype your admin and password in the web interface)")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"You might need to force-clear the cache of your browser sometimes to refresh\nthe JavaScript and/or HTML (so each time you edit something in ",(0,a.kt)("inlineCode",{parentName:"p"},"js")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"views"),")."))),(0,a.kt)("h3",{id:"your-feature-is-ready-and-you-want-it-to-be-integrated-in-yunohost"},"Your feature is ready and you want it to be integrated in YunoHost"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Fork the relevant repo on GitHub, and commit stuff to a new branch. We recommend\nto name the branch with the following convention:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"For an enhancement or new feature: ",(0,a.kt)("inlineCode",{parentName:"li"},"enh-ISSUENUMBER-name-of-feature")),(0,a.kt)("li",{parentName:"ul"},"For a bugfix ",(0,a.kt)("inlineCode",{parentName:"li"},"fix-ISSUENUMBER-description-of-fix")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ISSUENUMBER")," is optional and is the id of a corresponding ticket on the bug tracker."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Once you're ready, open a Pull Request (PR) on GitHub. Please include ",(0,a.kt)("inlineCode",{parentName:"p"},"[fix]")," or\n",(0,a.kt)("inlineCode",{parentName:"p"},"[enh]")," at the beginning of the title of your PR.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"After reviewing, testing and validation by other contributors, your branch\nshould be merged in ",(0,a.kt)("inlineCode",{parentName:"p"},"unstable"),"!"))))}d.isMDXComponent=!0}}]);