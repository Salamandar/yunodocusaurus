"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([[864],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>c});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=n.createContext({}),u=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},d="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=u(a),m=o,c=d["".concat(l,".").concat(m)]||d[m]||h[m]||r;return a?n.createElement(c,i(i({ref:t},p),{},{components:a})):n.createElement(c,i({ref:t},p))}));function c(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:o,i[1]=s;for(var u=2;u<r;u++)i[u]=a[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},40001:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>u});var n=a(87462),o=(a(67294),a(3905));const r={title:"Migrating from 4.x to 11.x",template:"docs",taxonomy:{category:"docs"},routes:{default:"/buster_bullseye_migration"}},i=void 0,s={unversionedId:"administer/admin_guide/upgrade/buster_bullseye_migration",id:"administer/admin_guide/upgrade/buster_bullseye_migration",title:"Migrating from 4.x to 11.x",description:"This page is dedicated to help you migrating an instance from YunoHost 4.4.x (running on Debian Buster/10.x) to YunoHost 11.x (running on Debian Bullseye/11.x). Note: we decided to skip the version numbers from 5 to 10 to follow the Debian version numbers.",source:"@site/docs/02.administer/15.admin_guide/55.upgrade/11.buster_bullseye_migration.md",sourceDirName:"02.administer/15.admin_guide/55.upgrade",slug:"/administer/admin_guide/upgrade/buster_bullseye_migration",permalink:"/yunodocusaurus/it/docs/administer/admin_guide/upgrade/buster_bullseye_migration",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/02.administer/15.admin_guide/55.upgrade/11.buster_bullseye_migration.md",tags:[],version:"current",sidebarPosition:11,frontMatter:{title:"Migrating from 4.x to 11.x",template:"docs",taxonomy:{category:"docs"},routes:{default:"/buster_bullseye_migration"}},sidebar:"tutorialSidebar",previous:{title:"Migrating from 3.x to 4.x",permalink:"/yunodocusaurus/it/docs/administer/admin_guide/upgrade/stretch_buster_migration"},next:{title:"Vista d'insieme dell'ecosistema YunoHost",permalink:"/yunodocusaurus/it/docs/administer/admin_guide/admin_guide"}},l={},u=[{value:"Important notes",id:"important-notes",level:2},{value:"Migration procedure",id:"migration-procedure",level:2},{value:"From the webadmin",id:"from-the-webadmin",level:4},{value:"From the command line",id:"from-the-command-line",level:4},{value:"During the migration",id:"during-the-migration",level:2},{value:"If the migration crashed / failed at some point.",id:"if-the-migration-crashed--failed-at-some-point",level:4},{value:"What to do after the upgrade",id:"what-to-do-after-the-upgrade",level:2},{value:"Check that you actually are on Debian Bullseye and YunoHost 11.x",id:"check-that-you-actually-are-on-debian-bullseye-and-yunohost-11x",level:4},{value:"Run the migration to repair your python app",id:"run-the-migration-to-repair-your-python-app",level:4},{value:"Check that no issue appeared in the diagnosis",id:"check-that-no-issue-appeared-in-the-diagnosis",level:4},{value:"Check that your applications are working",id:"check-that-your-applications-are-working",level:4},{value:"Current known issues after the migration",id:"current-known-issues-after-the-migration",level:2},{value:"Can&#39;t run the migration due to <code>libc6-dev : Breaks: libgcc-8-dev issue</code>.",id:"cant-run-the-migration-due-to-libc6-dev--breaks-libgcc-8-dev-issue",level:3},{value:"DNSmasq is not running anymore",id:"dnsmasq-is-not-running-anymore",level:3},{value:"No ethernet connexion after rebooting following a migration on a Raspberry Pi 4",id:"no-ethernet-connexion-after-rebooting-following-a-migration-on-a-raspberry-pi-4",level:3},{value:"Restore ynh4 backup onto a fresh ynh11",id:"restore-ynh4-backup-onto-a-fresh-ynh11",level:3}],p={toc:u},d="wrapper";function h(e){let{components:t,...a}=e;return(0,o.kt)(d,(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"This page is dedicated to help you migrating an instance from YunoHost 4.4.x (running on Debian Buster/10.x) to YunoHost 11.x (running on Debian Bullseye/11.x). Note: we decided to skip the version numbers from 5 to 10 to follow the Debian version numbers."),(0,o.kt)("h2",{id:"important-notes"},"Important notes"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The YunoHost team did its best to make sure that the migration is as smooth as possible and was tested over the course of several months in several cases.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"With that said, please be aware that this is a delicate operation. System administration is a complicated topic and covering every particular case is quite hard. Therefore, if you host critical data and services, please ",(0,o.kt)("a",{parentName:"p",href:"/backup"},"make backups"),". And in any case, be patient and attentive during the migration.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Please don't rush into thinking that you should need to reinstall your system from scratch thinking it would be \"simpler\" (sigh). (A common attitude is to be willing to reinstall a server at the slightest complication...). Instead, if you happen to run into issues, we encourage you to try to investigate and understand what's going on and ",(0,o.kt)("a",{parentName:"p",href:"/help"},"reach for help on the chat and the forum"),".")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"You should watch the known issues at the bottom of this page, to be sure your migrations will work properly.")))),(0,o.kt)("h2",{id:"migration-procedure"},"Migration procedure"),(0,o.kt)("h4",{id:"from-the-webadmin"},"From the webadmin"),(0,o.kt)("p",null,"After upgrading to 4.4.x, go to Tools > Migrations to access the migrations interface. You will have to read carefully and accept the disclaimer then launch the migration. "),(0,o.kt)("h4",{id:"from-the-command-line"},"From the command line"),(0,o.kt)("p",null,"After upgrading to 4.4.x, run : "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo yunohost tools migrations run\n")),(0,o.kt)("p",null,"then read carefully and accept the disclaimer."),(0,o.kt)("h2",{id:"during-the-migration"},"During the migration"),(0,o.kt)("p",null,"Depending on your hardware and packages installed, the migration might take up to a few hours. "),(0,o.kt)("p",null,"The logs will be shown in the message bar (you can hover it to see the whole history). They will also be available after the migration (like any other operations) in Tools > Logs."),(0,o.kt)("p",null,"Note that even if you close the webadmin page for some reason, the migration will continue in the background (but the webadmin will be partially unavailable)."),(0,o.kt)("h4",{id:"if-the-migration-crashed--failed-at-some-point"},"If the migration crashed / failed at some point."),(0,o.kt)("p",null,"If the migration failed at some point, it should be possible to relaunch it. If it still doesn't work, you can try to ",(0,o.kt)("a",{parentName:"p",href:"/help"},"get help")," (please provide the corresponding messages or whatever makes you say that it's not working)."),(0,o.kt)("h2",{id:"what-to-do-after-the-upgrade"},"What to do after the upgrade"),(0,o.kt)("h4",{id:"check-that-you-actually-are-on-debian-bullseye-and-yunohost-11x"},"Check that you actually are on Debian Bullseye and YunoHost 11.x"),(0,o.kt)("p",null,"For this, go to Diagnosis (category Base system) or look at the footer of the webadmin. In the command line, you can use ",(0,o.kt)("inlineCode",{parentName:"p"},"lsb_release -a")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"yunohost --version"),"."),(0,o.kt)("h4",{id:"run-the-migration-to-repair-your-python-app"},"Run the migration to repair your python app"),(0,o.kt)("p",null,"After upgrading, your python apps should be unavailable because their virtual environment (venv) needs to be rebuilt."),(0,o.kt)("p",null,"To do that you can run the pending migrations in ",(0,o.kt)("inlineCode",{parentName:"p"},"Webadmin > Update"),". The apps below won't be automatically repaired, you need to force-upgrade them manually instead with ",(0,o.kt)("inlineCode",{parentName:"p"},"yunohost app upgrade -F APP"),"."),(0,o.kt)("p",null,"Apps which won't be automatically repaired and need a force upgrade:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"calibreweb"),(0,o.kt)("li",{parentName:"ul"},"django-for-runners"),(0,o.kt)("li",{parentName:"ul"},"ffsync (this app is in python2 and no longer maintained, no guarantee)"),(0,o.kt)("li",{parentName:"ul"},"jupiterlab"),(0,o.kt)("li",{parentName:"ul"},"librephotos"),(0,o.kt)("li",{parentName:"ul"},"mautrix"),(0,o.kt)("li",{parentName:"ul"},"mediadrop"),(0,o.kt)("li",{parentName:"ul"},"mopidy"),(0,o.kt)("li",{parentName:"ul"},"pgadmin"),(0,o.kt)("li",{parentName:"ul"},"tracim"),(0,o.kt)("li",{parentName:"ul"},"synapse"),(0,o.kt)("li",{parentName:"ul"},"weblate")),(0,o.kt)("p",null,"!!! If needed, you can disable the automatic rebuild for a specific python app, by removing the dedicated file ending with ",(0,o.kt)("inlineCode",{parentName:"p"},".requirements_backup_for_bullseye_upgrade.txt")," before applying the migration. You can find this file near the venv (Python virtual environment) of your app inside ",(0,o.kt)("inlineCode",{parentName:"p"},"/opt")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"/var/www"),"."),(0,o.kt)("h4",{id:"check-that-no-issue-appeared-in-the-diagnosis"},"Check that no issue appeared in the diagnosis"),(0,o.kt)("p",null,"Also in the webadmin Diagnosis section, make sure that no specific issue appeared after running the migration (for example a service that crashed for some reason)."),(0,o.kt)("p",null,"If the service ",(0,o.kt)("inlineCode",{parentName:"p"},"php7.3-fpm")," appears to be dead, you should upgrade your PHP apps like the custom web app. Next, you can run ",(0,o.kt)("inlineCode",{parentName:"p"},"apt autoremove"),"."),(0,o.kt)("h4",{id:"check-that-your-applications-are-working"},"Check that your applications are working"),(0,o.kt)("p",null,"Test that your applications are working. If they aren't, you should try to upgrade them (it is also a good idea to upgrade them even if they are working anyway)."),(0,o.kt)("p",null,"If your app is broken and you were already with the latest version, you can rerun the upgrade thanks to the ",(0,o.kt)("inlineCode",{parentName:"p"},"-F|--force")," option:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"yunohost app upgrade --force APP_NAME\n")),(0,o.kt)("h2",{id:"current-known-issues-after-the-migration"},"Current known issues after the migration"),(0,o.kt)("h3",{id:"cant-run-the-migration-due-to-libc6-dev--breaks-libgcc-8-dev-issue"},"Can't run the migration due to ",(0,o.kt)("inlineCode",{parentName:"h3"},"libc6-dev : Breaks: libgcc-8-dev issue"),"."),(0,o.kt)("p",null,"Note: This issue should be resolved in yunohost_version: 4.4.2.13\nYou have an app that depends on the ",(0,o.kt)("inlineCode",{parentName:"p"},"build-essential")," package."),(0,o.kt)("p",null,"See this ",(0,o.kt)("a",{parentName:"p",href:"https://forum.yunohost.org/t/migration-to-11-wont-start-libc6-dev-breaks-libgcc-8-dev/20617/42"},"solution")," to fix it manually"),(0,o.kt)("h3",{id:"dnsmasq-is-not-running-anymore"},"DNSmasq is not running anymore"),(0,o.kt)("p",null,"We haven't yet found  solution for this issue."),(0,o.kt)("h3",{id:"no-ethernet-connexion-after-rebooting-following-a-migration-on-a-raspberry-pi-4"},"No ethernet connexion after rebooting following a migration on a Raspberry Pi 4"),(0,o.kt)("p",null,"! If you have not yet rebooted your server, don't do it (we are looking for a solution). This will avoid you the use of a keyboard and screen."),(0,o.kt)("p",null,"We found this in the Raspberry Pi documentation"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'when the dhcpcd5 package is updated to the latest version (1:8.1.2-1+rpt1 -> 1:8.1.2-1+rpt2), the Raspberry Pi will fail to obtain a DHCP IP address following the next reboot or startup. This problem can be avoided by disabling and re-enabling the "System Options -> Network at Boot" option using the latest raspi-config after the dhcpcd5 package has been updated and prior to the system being shutdown or rebooted\n')),(0,o.kt)("p",null,"If you are using a Raspberry Pi 4 (or maybe 3), see this ",(0,o.kt)("a",{parentName:"p",href:"https://forum.yunohost.org/t/aucun-acces-a-internet-suite-a-migration-4-4-to-11-depuis-raspberry-pi-4-pi-400/20652/17"},"solution")),(0,o.kt)("h3",{id:"restore-ynh4-backup-onto-a-fresh-ynh11"},"Restore ynh4 backup onto a fresh ynh11"),(0,o.kt)("p",null,"If you can't restore your app but your system has been restored, you probably should use the regen conf to fix the nginx issues:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"yunohost tools regenconf nginx --force\n")),(0,o.kt)("p",null,"After that you should be able to restore your apps. Don't forget to force upgrade theme if you have 502 errors."))}h.isMDXComponent=!0}}]);