"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([[7796],{3905:(e,a,t)=>{t.d(a,{Zo:()=>p,kt:()=>h});var n=t(67294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function l(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=n.createContext({}),u=function(e){var a=n.useContext(s),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},p=function(e){var a=u(e.components);return n.createElement(s.Provider,{value:a},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},d=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=u(t),d=r,h=c["".concat(s,".").concat(d)]||c[d]||m[d]||o;return t?n.createElement(h,i(i({ref:a},p),{},{components:t})):n.createElement(h,i({ref:a},p))}));function h(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=d;var l={};for(var s in a)hasOwnProperty.call(a,s)&&(l[s]=a[s]);l.originalType=e,l[c]="string"==typeof e?e:r,i[1]=l;for(var u=2;u<o;u++)i[u]=t[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}d.displayName="MDXCreateElement"},52006:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var n=t(87462),r=(t(67294),t(3905));const o={title:"Backing up your server",template:"docs",taxonomy:{category:"docs"},routes:{default:"/backup"}},i=void 0,l={unversionedId:"administer/admin_guide/backup",id:"administer/admin_guide/backup",title:"Backing up your server",description:"In the context of self-hosting, backups are an important element to compensate for unexpected events (fire, database corruption, loss of access to the server, compromised server...). The backup policy to implement depends on the importance of the services and data you manage. For example, backing up a test server will be of little interest, while you will want to be very careful if you are managing critical data for an association or a company - and in such cases, you will want to store the backups in a different location or locations.",source:"@site/docs/02.administer/15.admin_guide/50.backup.md",sourceDirName:"02.administer/15.admin_guide",slug:"/administer/admin_guide/backup",permalink:"/yunodocusaurus/ca/docs/administer/admin_guide/backup",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/02.administer/15.admin_guide/50.backup.md",tags:[],version:"current",sidebarPosition:50,frontMatter:{title:"Backing up your server",template:"docs",taxonomy:{category:"docs"},routes:{default:"/backup"}},sidebar:"tutorialSidebar",previous:{title:"Emails",permalink:"/yunodocusaurus/ca/docs/administer/admin_guide/email"},next:{title:"Upgrades",permalink:"/yunodocusaurus/ca/docs/administer/admin_guide/upgrade/"}},s={},u=[{value:"Manual backup",id:"manual-backup",level:2},{value:"Backup",id:"backup",level:3},{value:"Creating backups",id:"creating-backups",level:4},{value:"Downloading backups",id:"downloading-backups",level:4},{value:"Testing",id:"testing",level:3},{value:"Restoring backups",id:"restoring-backups",level:3},{value:"Simple case: little data, archive already present",id:"simple-case-little-data-archive-already-present",level:4},{value:"Upload an archive",id:"upload-an-archive",level:4},{value:"Automatic or remote backup",id:"automatic-or-remote-backup",level:2},{value:"Go further",id:"go-further",level:2}],p={toc:u},c="wrapper";function m(e){let{components:a,...t}=e;return(0,r.kt)(c,(0,n.Z)({},p,t,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"In the context of self-hosting, backups are an important element to compensate for unexpected events (fire, database corruption, loss of access to the server, compromised server...). The backup policy to implement depends on the importance of the services and data you manage. For example, backing up a test server will be of little interest, while you will want to be very careful if you are managing critical data for an association or a company - and in such cases, you will want to store the backups ",(0,r.kt)("em",{parentName:"p"},"in a different location or locations"),"."),(0,r.kt)("h2",{id:"manual-backup"},"Manual backup"),(0,r.kt)("h3",{id:"backup"},"Backup"),(0,r.kt)("p",null,"YunoHost comes with a backup system, that allows you to backup (and restore) system configurations and data (e.g. emails) and apps if they support it."),(0,r.kt)("p",null,"You can manage backups either from the command line (",(0,r.kt)("inlineCode",{parentName:"p"},"yunohost backup --help"),") or from the web administration (in the Backups section), though some features are not yet available in the webadmin."),(0,r.kt)("p",null,"The current default method consists in creating a ",(0,r.kt)("inlineCode",{parentName:"p"},".tar")," archive containing all relevant files."),(0,r.kt)("h4",{id:"creating-backups"},"Creating backups"),(0,r.kt)("p",null,'[ui-tabs position="top-left" active="0" theme="lite"][ui-tab title="From the webadmin"]'),(0,r.kt)("p",null,"You can easily create backup archives from the webadmin by going to ",(0,r.kt)("inlineCode",{parentName:"p"},"Backups > Local storage")," and clicking on ",(0,r.kt)("inlineCode",{parentName:"p"},"New backup"),". You will then be asked to select which configuration, data and apps you want to backup."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"image://backup.png",alt:"picture of YunoHost's backup pannel"})),(0,r.kt)("p",null,'[/ui-tab][ui-tab title="From the command line"]'),(0,r.kt)("p",null,"You can create a new backup archive from the command line. Here are a few simple examples of commands and their corresponding behavior:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Backing up everything (all system parts and apps):"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yunohost backup create\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Backing up only apps"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yunohost backup create --apps\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Backing up only two apps (wordpress and shaarli)"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yunohost backup create --apps wordpress shaarli\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Backing up only emails"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yunohost backup create --system data_mail\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Backing up emails and wordpress"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yunohost backup create --system data_mail --apps wordpress\n")))),(0,r.kt)("p",null,"For more information and options about backup creation, consult ",(0,r.kt)("inlineCode",{parentName:"p"},"yunohost backup create --help"),". You can also list the system parts that can be backed up with ",(0,r.kt)("inlineCode",{parentName:"p"},"yunohost hook list backup"),".\n","[/ui-tab][/ui-tabs]"),(0,r.kt)("h4",{id:"downloading-backups"},"Downloading backups"),(0,r.kt)("p",null,'[ui-tabs position="top-left" active="0" theme="lite"][ui-tab title="From the webadmin"]',"\nAfter creating backups, it is possible to list and inspect them using the corresponding views in the web administration interface. A button allows you to download the archive. If the archive is larger than 3GB, it may be better to proceed via SFTP."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Backup > Local Archives > <Archive name> > Download")),(0,r.kt)("p",null,'[/ui-tab][ui-tab title="With a SFTP client"]',"\nCurrently, the most accessible way to download big archives is to use the program FileZilla as explained in ",(0,r.kt)("a",{parentName:"p",href:"/filezilla"},"this page"),"."),(0,r.kt)("p",null,"By default, backups are stored in ",(0,r.kt)("inlineCode",{parentName:"p"},"/home/yunohost.backup/archives/"),"."),(0,r.kt)("p",null,'[/ui-tab][ui-tab title="From the command line"]',"\nThe ",(0,r.kt)("inlineCode",{parentName:"p"},"yunohost backup list")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"yunohost backup info <archive_name>")," commands provide information about the names and sizes of backups."),(0,r.kt)("p",null,"It is possible to use ",(0,r.kt)("inlineCode",{parentName:"p"},"scp")," (a program based on ",(0,r.kt)("a",{parentName:"p",href:"/ssh"},(0,r.kt)("inlineCode",{parentName:"a"},"ssh")),") to copy files between two machines via the command line. So, from a GNU/Linux machine, you can use the following command to download an archive:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"scp admin@your.domain.tld:/home/yunohost.backup/archives/<archive_name>.tar ./\n")),(0,r.kt)("p",null,"If your SSH port is different from 22"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"scp -P ssh_port admin@your.domain.tld:/home/yunohost.backup/archives/<archive_name>.tar ./\n")),(0,r.kt)("p",null,"[/ui-tab][/ui-tabs]"),(0,r.kt)("p",null,"! Don't forget to store your backup in a different place to your server."),(0,r.kt)("p",null,"!!! If you want, you can connect an external disk to your server so that the archives arrive directly on it. See this guide to ",(0,r.kt)("a",{parentName:"p",href:"/external_storage"},"Adding external storage to your server")),(0,r.kt)("h3",{id:"testing"},"Testing"),(0,r.kt)("p",null,"You should regularly test your backups by at least listing the contents of the archives and checking the size of the associated data. It is best to practice restoring regularly."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'# List the files\ntar -tvf /home/yunohost.backup/archives/ARCHIVE.tar | less\n\n# List database exports\ntar -tvf /home/yunohost.backup/archives/ARCHIVE.tar | grep "(db|dump)`.sql"\n\n# Check the weight\nls -lh /home/yunohost.backup/archives/ARCHIVE.tar\n')),(0,r.kt)("h3",{id:"restoring-backups"},"Restoring backups"),(0,r.kt)("p",null,"!!! SPOILER: The larger your data volume and the more applications you have, the more complex your recovery will be."),(0,r.kt)("h4",{id:"simple-case-little-data-archive-already-present"},"Simple case: little data, archive already present"),(0,r.kt)("p",null,'[ui-tabs position="top-left" active="0" theme="lite"][ui-tab title="From the webadmin"]'),(0,r.kt)("p",null,"Go in ",(0,r.kt)("inlineCode",{parentName:"p"},"Backup > Local storage")," and select your archive. You can then select which items you want to restore, then click on 'Restore'."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"image://restore.png",alt:"picture of YunoHost's restore pannel"})),(0,r.kt)("p",null,'[/ui-tab][ui-tab title="From the command line"]'),(0,r.kt)("p",null,"From the command line, you can run ",(0,r.kt)("inlineCode",{parentName:"p"},"yunohost backup list")," to get the available archive names. They are basically their file name without extension."),(0,r.kt)("p",null,"You can then run ",(0,r.kt)("inlineCode",{parentName:"p"},"yunohost backup restore <archivename>")," (hence without its ",(0,r.kt)("inlineCode",{parentName:"p"},".tar")," extension) to restore an archive. As for ",(0,r.kt)("inlineCode",{parentName:"p"},"yunohost backup create"),", this will restore everything in the archive by default. If you want to restore only specific items, you can use something like ",(0,r.kt)("inlineCode",{parentName:"p"},"yunohost backup restore <archivename> --apps wordpress"),", which will restore only the wordpress app."),(0,r.kt)("p",null,"!!! In the case of a complete restoration, it is possible to restore instead of launching the initial configuration.\n","[/ui-tab][/ui-tabs]"),(0,r.kt)("p",null,"To restore an app, the domain on which it was installed should already be configured (or you need to restore the corresponding system configuration). You also cannot restore an app which is already installed... which means that to restore an old version of an app, you must first uninstall it."),(0,r.kt)("h4",{id:"upload-an-archive"},"Upload an archive"),(0,r.kt)("p",null,"In many cases, the archive is not on the server on which you want to restore it. So it has to be uploaded, which depending on its size can take more or less time."),(0,r.kt)("p",null,'[ui-tabs position="top-left" active="0" theme="lite"][ui-tab title="With an SFTP client"]',"\nCurrently, the most accessible solution for uploading backups is to use the FileZilla program as explained in ",(0,r.kt)("a",{parentName:"p",href:"/filezilla"},"this page"),"."),(0,r.kt)("p",null,"By default, backups are to be placed in ",(0,r.kt)("inlineCode",{parentName:"p"},"/home/yunohost.backup/archives/"),".\n",'[/ui-tab][ui-tab title="From the command line"]',"\nYou can upload a backup from a machine to your server with :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"scp /path/to/your/<archive_name>.tar admin@your.domain.tld:/home/yunohost.backup/archives/\n")),(0,r.kt)("p",null,"If your SSH port is different from 22"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"scp -P ssh_port /path/to/your/<archive_name>.tar admin@your.domain.tld:/home/yunohost.backup/archives/\n")),(0,r.kt)("p",null,"[/ui-tab][/ui-tabs]"),(0,r.kt)("h2",{id:"automatic-or-remote-backup"},"Automatic or remote backup"),(0,r.kt)("p",null,"There are 3 YunoHost applications that offer to extend YunoHost with an automated backup method."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/backup/borgbackup"},"BorgBackup")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/backup/restic"},"Restic")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/backup/archivist"},"Archivist"))),(0,r.kt)("h2",{id:"go-further"},"Go further"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/backup/strategies"},"Evaluate the quality of your backup")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/backup/clone_filesystem"},"Clone your file system")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/backup/avoid_hardware_failure"},"Avoid a hardware failure")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/backup/include_exclude_files"},"Include/exclude files")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/backup/custom_backup_methods"},"Custom methods")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/backup/migrate_or_merge_servers"},"Migrate or merge servers"))))}m.isMDXComponent=!0}}]);