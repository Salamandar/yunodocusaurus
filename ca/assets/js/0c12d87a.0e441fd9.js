"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([[256],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>y});var o=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,o)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function n(e,t){if(null==e)return{};var a,o,r=function(e,t){if(null==e)return{};var a,o,r={},p=Object.keys(e);for(o=0;o<p.length;o++)a=p[o],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(o=0;o<p.length;o++)a=p[o],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var i=o.createContext({}),u=function(e){var t=o.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=u(e.components);return o.createElement(i.Provider,{value:t},e.children)},l="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var a=e.components,r=e.mdxType,p=e.originalType,i=e.parentName,c=n(e,["components","mdxType","originalType","parentName"]),l=u(a),d=r,y=l["".concat(i,".").concat(d)]||l[d]||h[d]||p;return a?o.createElement(y,s(s({ref:t},c),{},{components:a})):o.createElement(y,s({ref:t},c))}));function y(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var p=a.length,s=new Array(p);s[0]=d;var n={};for(var i in t)hasOwnProperty.call(t,i)&&(n[i]=t[i]);n.originalType=e,n[l]="string"==typeof e?e:r,s[1]=n;for(var u=2;u<p;u++)s[u]=a[u];return o.createElement.apply(null,s)}return o.createElement.apply(null,a)}d.displayName="MDXCreateElement"},98691:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>h,frontMatter:()=>p,metadata:()=>n,toc:()=>u});var o=a(87462),r=(a(67294),a(3905));const p={title:"BorgBackup",template:"docs",taxonomy:{category:"docs"},routes:{default:"/backup/borgbackup"},"page-toc":{active:!0,depth:3}},s=void 0,n={unversionedId:"administer/backups/backup_methods/borgbackup",id:"administer/backups/backup_methods/borgbackup",title:"BorgBackup",description:"YunoHost offers a couple of applications for BorgBackup.",source:"@site/docs/02.administer/20.backups/10.backup_methods/01.borgbackup.md",sourceDirName:"02.administer/20.backups/10.backup_methods",slug:"/administer/backups/backup_methods/borgbackup",permalink:"/yunodocusaurus/ca/docs/administer/backups/backup_methods/borgbackup",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/02.administer/20.backups/10.backup_methods/01.borgbackup.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"BorgBackup",template:"docs",taxonomy:{category:"docs"},routes:{default:"/backup/borgbackup"},"page-toc":{active:!0,depth:3}},sidebar:"tutorialSidebar",previous:{title:"Backup strategies",permalink:"/yunodocusaurus/ca/docs/administer/backups/evaluate"},next:{title:"Restic",permalink:"/yunodocusaurus/ca/docs/administer/backups/backup_methods/restic"}},i={},u=[{value:"Functionality",id:"functionality",level:2},{value:"Setting up the backup",id:"setting-up-the-backup",level:2},{value:"Test",id:"test",level:2},{value:"Restore",id:"restore",level:2},{value:"Restore large archives",id:"restore-large-archives",level:3}],c={toc:u},l="wrapper";function h(e){let{components:t,...a}=e;return(0,r.kt)(l,(0,o.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"YunoHost offers a couple of applications for ",(0,r.kt)("a",{parentName:"p",href:"https://www.borgbackup.org/"},"BorgBackup"),"."),(0,r.kt)("h2",{id:"functionality"},"Functionality"),(0,r.kt)("p",null,"This application offers:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"backup of data on an external disk or on a remote Borg repository"),(0,r.kt)("li",{parentName:"ul"},"deduplication and compression of files, which allows to keep many previous copies"),(0,r.kt)("li",{parentName:"ul"},"data encryption, which allows you to store data with a third party"),(0,r.kt)("li",{parentName:"ul"},"to define the frequency and type of data to be backed up"),(0,r.kt)("li",{parentName:"ul"},"a mail alert system in case of backup failure.")),(0,r.kt)("p",null,"There are ",(0,r.kt)("a",{parentName:"p",href:"https://www.borgbackup.org/support/commercial.html"},"remote borg repository providers"),", it is also possible to create your own repository on another YunoHost with the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/YunoHost-Apps/borgserver_ynh"},"borgserver application"),"."),(0,r.kt)("p",null,"The future default backup method integrated in YunoHost will be based on this software."),(0,r.kt)("h2",{id:"setting-up-the-backup"},"Setting up the backup"),(0,r.kt)("p",null,"!!! To set up, first install the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/YunoHost-Apps/borg_ynh"},"borg application"),", then optionally the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/YunoHost-Apps/borgserver_ynh"},"borgserver application"),"."),(0,r.kt)("h2",{id:"test"},"Test"),(0,r.kt)("p",null,"With the borg apps an email is sent to say if the backup fails or if the remote repo has received nothing. However, you can manually test to make sure everything is fine in a more complete way."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'# List files\napp=borg; BORG_PASSPHRASE="$(yunohost app setting $app passphrase)" BORG_RSH="ssh -i /root/.ssh/id_${app}_ed25519 -oStrictHostKeyChecking=yes " borg list "$(yunohost app setting $app repository)" | less\n\n# List database exports\napp=borg; BORG_PASSPHRASE="$(yunohost app setting $app passphrase)" BORG_RSH="ssh -i /root/.ssh/id_${app}_ed25519 -oStrictHostKeyChecking=yes " borg list "$(yunohost app setting $app repository)" | grep "(db|dump)\\.sql"\n\n# List files from the archive\napp=borg; BORG_PASSPHRASE="$(yunohost app setting $app passphrase)" BORG_RSH="ssh -i /root/.ssh/id_${app}_ed25519 -oStrictHostKeyChecking=yes " borg list "$(yunohost app setting $app repository)::ARCHIVE" | less\n\n# View archive info\napp=borg; BORG_PASSPHRASE="$(yunohost app setting $app passphrase)" BORG_RSH="ssh -i /root/.ssh/id_${app}_ed25519 -oStrictHostKeyChecking=yes " borg info "$(yunohost app setting $app repository)::ARCHIVE"\n\n# Verify data integrity\napp=borg; BORG_PASSPHRASE="$(yunohost app setting $app passphrase)" BORG_RSH="ssh -i /root/.ssh/id_${app}_ed25519 -oStrictHostKeyChecking=yes " borg check "$(yunohost app setting $app repository)::ARCHIVE" --verify-data\n')),(0,r.kt)("h2",{id:"restore"},"Restore"),(0,r.kt)("p",null,"If we are in the case of a migration or a reinstallation, we must reinstall borg in the same way. If the repo is remote you have to change the public key."),(0,r.kt)("p",null,"List the available archives"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'app=borg; BORG_PASSPHRASE="$(yunohost app setting $app passphrase)" BORG_RSH="ssh -i /root/.ssh/id_${app}_ed25519 -oStrictHostKeyChecking=yes " borg list "$(yunohost app setting $app repository)"\n')),(0,r.kt)("p",null,"Create tar archives (one archive per app and system part)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'app=borg; BORG_PASSPHRASE="$(yunohost app setting $app passphrase)" BORG_RSH="ssh -i /root/.ssh/id_${app}_ed25519 -oStrictHostKeyChecking=yes " borg export-tar "$(yunohost app setting $app repository)::ARCHIVE" /home/yunohost/archives/ARCHIVE.tar\n')),(0,r.kt)("p",null,"Then restore the archive in the usual way."),(0,r.kt)("h3",{id:"restore-large-archives"},"Restore large archives"),(0,r.kt)("p",null,"If the available space is less than the weight of your archive, decompressed data and dependencies, you will have to restore part by part, app by app."),(0,r.kt)("p",null,'If restoring app by app is not enough OR if an archive is too big, it may be a good idea to generate a tarball without the "big" data of an app as if it had been generated with the ',"[BACKUP_CORE_ONLY option]"," (/backup/include_exclude_files#don't-save-large-quantities-of-data). Example with Nextcloud:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'app=borg; BORG_PASSPHRASE="$(yunohost app setting $app passphrase)" BORG_RSH="ssh -i /root/.ssh/id_${app}_ed25519 -oStrictHostKeyChecking=yes " borg export-tar -e apps/nextcloud/backup/home/yunohost.app "$(yunohost app setting $app repository)::ARCHIVE" /home/yunohost/archives/ARCHIVE.tar\n')),(0,r.kt)("p",null,"You will then have to extract these data directly with borg"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'cd /home/yunohost.app/\napp=borg; BORG_PASSPHRASE="$(yunohost app setting $app passphrase)" BORG_RSH="ssh -i /root/.ssh/id_${app}_ed25519 -oStrictHostKeyChecking=yes " borg extract "$(yunohost app setting $app repository)::ARCHIVE" apps/nextcloud/backup/home/yunohost.app/\nmv apps/nextcloud/backup/home/yunohost.app/nextcloud ./\nrm -r apps\n')),(0,r.kt)("p",null,"Then restore in the classic way"))}h.isMDXComponent=!0}}]);