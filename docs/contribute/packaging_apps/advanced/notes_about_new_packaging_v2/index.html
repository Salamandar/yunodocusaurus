<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-contribute/packaging_apps/advanced/notes_about_new_packaging_v2" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Packaging v2 | Yunohost</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://yunohost.org/yunodocusaurus/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://yunohost.org/yunodocusaurus/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://yunohost.org/yunodocusaurus/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Packaging v2 | Yunohost"><meta data-rh="true" name="description" content="Packaging v2 is a major improvement for the packaging introduced in YunoHost 11.1"><meta data-rh="true" property="og:description" content="Packaging v2 is a major improvement for the packaging introduced in YunoHost 11.1"><link data-rh="true" rel="icon" href="/yunodocusaurus/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://yunohost.org/yunodocusaurus/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/"><link data-rh="true" rel="alternate" href="https://yunohost.org/yunodocusaurus/ar/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/" hreflang="ar"><link data-rh="true" rel="alternate" href="https://yunohost.org/yunodocusaurus/ca/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/" hreflang="ca"><link data-rh="true" rel="alternate" href="https://yunohost.org/yunodocusaurus/de/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/" hreflang="de"><link data-rh="true" rel="alternate" href="https://yunohost.org/yunodocusaurus/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/" hreflang="en"><link data-rh="true" rel="alternate" href="https://yunohost.org/yunodocusaurus/es/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/" hreflang="es"><link data-rh="true" rel="alternate" href="https://yunohost.org/yunodocusaurus/fr/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/" hreflang="fr"><link data-rh="true" rel="alternate" href="https://yunohost.org/yunodocusaurus/it/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/" hreflang="it"><link data-rh="true" rel="alternate" href="https://yunohost.org/yunodocusaurus/oc/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/" hreflang="oc"><link data-rh="true" rel="alternate" href="https://yunohost.org/yunodocusaurus/ru/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/" hreflang="ru"><link data-rh="true" rel="alternate" href="https://yunohost.org/yunodocusaurus/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/yunodocusaurus/blog/rss.xml" title="Yunohost RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/yunodocusaurus/blog/atom.xml" title="Yunohost Atom Feed"><link rel="stylesheet" href="/yunodocusaurus/assets/css/styles.a1e52bfd.css">
<link rel="preload" href="/yunodocusaurus/assets/js/runtime~main.f43fea63.js" as="script">
<link rel="preload" href="/yunodocusaurus/assets/js/main.8f65e1ab.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/yunodocusaurus/"><div class="navbar__logo"><img src="/yunodocusaurus/img/YunoHost_logo_vertical.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/yunodocusaurus/img/YunoHost_logo_vertical.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Yunohost documentation</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/yunodocusaurus/docs/">Tutorial</a><a class="navbar__item navbar__link" href="/yunodocusaurus/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/yunodocusaurus/ar/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ar">العربية</a></li><li><a href="/yunodocusaurus/ca/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ca">Català</a></li><li><a href="/yunodocusaurus/de/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="de">Deutsch</a></li><li><a href="/yunodocusaurus/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/yunodocusaurus/es/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="es">Español</a></li><li><a href="/yunodocusaurus/fr/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="fr">Français</a></li><li><a href="/yunodocusaurus/it/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="it">Italiano</a></li><li><a href="/yunodocusaurus/oc/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="oc">Occitan</a></li><li><a href="/yunodocusaurus/ru/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ru">Русский</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/yunodocusaurus/docs/">Welcome!</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/yunodocusaurus/docs/overview/">Overview</a><button aria-label="Toggle the collapsible sidebar category &#x27;Overview&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/yunodocusaurus/docs/administer/">Administration guide</a><button aria-label="Toggle the collapsible sidebar category &#x27;Administration guide&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/yunodocusaurus/docs/user_guide/">User guide</a><button aria-label="Toggle the collapsible sidebar category &#x27;User guide&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/yunodocusaurus/docs/applications/docs/app_20euros/">applications</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/yunodocusaurus/docs/community/">Community</a><button aria-label="Toggle the collapsible sidebar category &#x27;Community&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/yunodocusaurus/docs/contribute/write_documentation/">contribute</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/yunodocusaurus/docs/contribute/write_documentation/">Write documentation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Write documentation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/yunodocusaurus/docs/contribute/packaging_apps/">Introduction to packaging</a><button aria-label="Toggle the collapsible sidebar category &#x27;Introduction to packaging&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/yunodocusaurus/docs/contribute/packaging_apps/manifest/">Writing the app manifest</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/yunodocusaurus/docs/contribute/packaging_apps/scripts/">Writing app scripts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/yunodocusaurus/docs/contribute/packaging_apps/doc/">Adding documentation to your app</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/yunodocusaurus/docs/contribute/packaging_apps/testing/">Testing your app</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/yunodocusaurus/docs/contribute/packaging_apps/publishing/">Publishing your app on the catalog</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/yunodocusaurus/docs/contribute/packaging_apps/advanced/config_panels/">advanced</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/yunodocusaurus/docs/contribute/packaging_apps/advanced/config_panels/">Configuration panel for apps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/yunodocusaurus/docs/contribute/packaging_apps/advanced/sso_ldap_integration/">SSO/LDAP integration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/yunodocusaurus/docs/contribute/packaging_apps/advanced/packaging_apps_hooks/">Hooks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/yunodocusaurus/docs/contribute/packaging_apps/advanced/advanced_packagers/">Advanced packagers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/yunodocusaurus/docs/contribute/packaging_apps/advanced/notes_about_new_packaging_v2/">Packaging v2</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/yunodocusaurus/docs/contribute/packaging_apps/resources/packaging_apps_git/">resources</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/yunodocusaurus/docs/contribute/dev/">Contributing to the YunoHost core</a><button aria-label="Toggle the collapsible sidebar category &#x27;Contributing to the YunoHost core&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/yunodocusaurus/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">contribute</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/yunodocusaurus/docs/contribute/packaging_apps/"><span itemprop="name">Introduction to packaging</span></a><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">advanced</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Packaging v2</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Packaging v2</h1></header><p>Packaging v2 is a major improvement for the packaging introduced in YunoHost 11.1</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="motivation">Motivation<a href="#motivation" class="hash-link" aria-label="Direct link to Motivation" title="Direct link to Motivation">​</a></h3><p>The motivations for this new format is:</p><ul><li>to get rid of some boring or unecessarily complex or duplicateds stuff such as saving/loading settings, creating a system user, etc.. during the install/upgrade/restore script, which are common things accross many apps.</li><li>to get rid of funky historical, not-super-semantic stuff such as <code>__FINALPATH__</code> being replaced by <code>$final_path</code> (with underscore), or <code>__PATH__</code> being replaced by <code>$path_url</code>, etc.</li><li>formalize some aspects such as the existence of the install dir, data dir, apt dependencies, database, etc. which in turn unlock possible future developments such as computing the space used by an app at one given moment, auto-upgrading apt dependencies during Debian major migration, etc.</li><li>formalize some meta-info such as LDAP/SSO support, architectures supports, and other pre-install / post-install, pre-upgrade / post-upgrade notifications (replacing the infamous <code>ynh_send_readme_to_admin</code>) for better UI/UX during the install and upgrade process.</li></ul><p>However, this &quot;v2&quot; is not the end of the story and should be seen as an intermediate stage before a &quot;v3&quot; packaging. In particular this &quot;v3&quot; packaging should also formalize the handling of the system and app configurations files and ultimately rework the entire paradigm of the install/remove/upgrade/backup/restore scripts.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="adapting-a-v1-app-to-v2">Adapting a v1 app to v2<a href="#adapting-a-v1-app-to-v2" class="hash-link" aria-label="Direct link to Adapting a v1 app to v2" title="Direct link to Adapting a v1 app to v2">​</a></h3><p>A script is available in <a href="https://github.com/YunoHost/apps/tree/master/tools/packaging_v2" target="_blank" rel="noopener noreferrer">https://github.com/YunoHost/apps/tree/master/tools/packaging_v2</a> and will attempt to convert what it can from the v1 format to the v2 format, in particular:</p><ul><li>initializing a <code>manifest.toml</code> and prefilling it with info scrapped from the various scripts</li><li>comment out now-unecessary lines in the various scripts</li></ul><p>Usage: <code>python3 convert_app_to_packaging_v2.py /path/yo/your/app</code></p><p>This will edit the file in place and you should then carefully review and iterate over what the script did for you.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="highlights-of-the-new-format">Highlights of the new format<a href="#highlights-of-the-new-format" class="hash-link" aria-label="Direct link to Highlights of the new format" title="Direct link to Highlights of the new format">​</a></h3><p>The <a href="https://github.com/YunoHost/example_ynh" target="_blank" rel="noopener noreferrer">example repo</a> illustrates the below.</p><ul><li><strong>The manifest is now written as toml (<code>manifest.toml</code>)</strong> instead of json (<code>manifest.json</code>). The structure of the manifest itself has been reworked and now include:<ul><li>The <code>upstream</code> section (now mandatory)</li><li>An <code>integration</code> section meant to formalize what minimum YunoHost version is required, the list of supported architectures, declare if SSO/LDAP is supported, typical resource usage. This is meant to be displayed both in the catalog (similar to app stores) and on the app info page after installing the app - though this is still work in progress. </li><li>A <code>resource</code> section (detailed below)</li></ul></li><li><strong>Install questions are now automatically saved as settings</strong> (except user-provided password and other specific infos)</li><li><strong>All settings are now automatically loaded in app script environments</strong> (so e.g. directly define <code>$domain</code>, etc.)</li><li><strong>Auto-enable <code>set -eu</code></strong> a.k.a. <code>ynh_abort_if_errors</code> in appropriate scripts</li><li><strong>The safety-backup-before-upgrade is now automatically handled by the core</strong></li><li><strong>Simplify writing change-url scripts</strong>: old the <code>new</code>/<code>old</code>/<code>change</code> <code>domain</code>/<code>path</code> are now automatically available in the context and a new helper <code>ynh_change_url_nginx_config</code> takes care of tweaking the nginx conf. Your script should essentially just call that helper and possibly tweak the app&#x27;s conf and possibly restart the app&#x27;s service</li><li><strong>Introduce a new <code>resource</code> mechanism</strong><ul><li>Resources are declared in the <code>manifest.toml</code>. </li><li>They are meant to formalize recurring app needs that are to be provisioned/deprovisioned by the core. </li><li>They include for example: system user, apt dependencies, install dir, data dir, port, permissions, SQL database... </li><li>Each resource is to be provisioned <em>before</em> running the install script, deprovisioned <em>after</em> the remove script, and automatically upgraded if needed before running the upgrade script (or provisionned if introduced in the new app version, or deprovisioned if removed w.r.t. the previous app version)</li><li>More infos about resources and their options and behavior are available in the dedicated doc page</li></ul></li><li><strong>Permissions are automatically initialized using the answer to the <code>init_main_permission</code> install question</strong> (replacing the <code>is_public</code> question). No need to write a boring <code>if $is_public ...</code> in the install script to add visitors anymore ! There is a similar mechanism to init other permissions, eg <code>init_admin_permission</code> (cf also the doc about the <code>permission</code> resource)</li><li><strong>The content of the <code>doc/</code> folder is now meant to be integrated in the webadmin</strong> (though this is still WIP as of writing this). In particular:<ul><li><code>DESCRIPTION.md</code> and the <code>screenshots/</code> folder are expected to be displayed prior to the app install form (similar to app stores on mobile)</li><li><code>ADMIN.md</code> is expected to be made available somewhere in the info page and should contain technical admin notes. Other pages can be defined (just name it <code>WHATEVER.md</code>). Lang codes are also supported following the existing scheme for the README, eg <code>README_fr.md</code> is the French version, hence you can create <code>ADMIN_fr.md</code>, etc.</li><li>Note that the <code>ADMIN.md</code> page supports the <code>__FOOBAR__</code> notation that will be automatically replaced with the app&#x27;s <code>foobar</code> setting</li></ul></li><li><strong>Special files called &#x27;notifications&#x27; are meant to replace the <code>ynh_send_readme_to_admin</code> mechanics</strong>. They are also to be added to the <code>doc</code> folder: <ul><li><code>doc/PRE_INSTALL.md</code>: a note to be displayed prior to the app install. Typically to warn of something unusual, such as &quot;the app install will automatically add 1GB swap to the system&quot;.</li><li><code>doc/POST_INSTALL.md</code>: a note to be displayed after the app install. Typically to explain post-install operations to be performed manually by the admin and that cannot be automated.</li><li><code>doc/PRE_UPGRADE.md</code>: a note to be displayed prior to any upgrade of this app.</li><li><code>doc/PRE_UPGRADE.d/{version}.md</code>: a note to be displayed prior to a specific version upgrade.</li><li><code>doc/POST_UPGRADE.md</code>: a note to be displayed after the app upgrade. For example in the context of Nextcloud, the fact that you may need to re-enable custom modules manually?</li><li>Note that the notifications, like <code>ADMIN.md</code>, supports the <code>__FOOBAR__</code> notation that will be automatically replaced with the app&#x27;s <code>foobar</code> setting</li></ul></li><li><strong>Replace some historical names with more sensible ones</strong>, or homogenize some practices:<ul><li><code>final_path</code> is now <code>install_dir</code> (this migration should be automatically handled by the core and the <code>convert_app_to_packaging_v2.py</code> script)</li><li><code>datadir</code> is now <code>data_dir</code> to be consistent with <code>install_dir</code> (this migration should be automatically handled by the core and the <code>convert_app_to_packaging_v2.py</code> script)</li><li><code>path</code> is now always loaded as <code>$path</code>, no funky <code>$path_url</code>-but-it-is-saved-as-<code>path</code> anymore (this migration should be automatically handled by the core and the <code>convert_app_to_packaging_v2.py</code> script)</li><li><code>mysqldbpwd</code> and <code>psqlpwd</code> or whatever are now always saved as <code>db_pwd</code> (cf the <code>database</code> resource) (this migration should be automatically handled by the core and the <code>convert_app_to_packaging_v2.py</code> script)</li><li>ports settings are now always named either <code>$port</code> or <code>$port_foo_bar</code> instead of <code>$foo_bar_port</code> (cf the <code>port</code> resource) (this migration should be automatically handled by the core and the <code>convert_app_to_packaging_v2.py</code> script)</li><li>the install dir is to be set to <code>/var/www/$app</code> by default for web apps (or can be changed to <code>/opt/????</code> for non-webapps). Note that YunoHost will <strong>automatically move</strong> the old install dir to the new <code>install_dir</code> during the corresponding upgrade.</li></ul></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/06.contribute/10.packaging_apps/60.advanced/70.notes_about_new_packaging_v2.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/yunodocusaurus/docs/contribute/packaging_apps/advanced/advanced_packagers/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Advanced packagers</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/yunodocusaurus/docs/contribute/packaging_apps/resources/packaging_apps_git/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Use Git to package apps</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a></li><li><a href="#adapting-a-v1-app-to-v2" class="table-of-contents__link toc-highlight">Adapting a v1 app to v2</a></li><li><a href="#highlights-of-the-new-format" class="table-of-contents__link toc-highlight">Highlights of the new format</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/yunodocusaurus/docs/intro/">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/yunodocusaurus/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/yunodocusaurus/assets/js/runtime~main.f43fea63.js"></script>
<script src="/yunodocusaurus/assets/js/main.8f65e1ab.js"></script>
</body>
</html>